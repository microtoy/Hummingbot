import{d as ne,a7 as ye,r as h,aN as Ie,g as ge,h as ie,c as n,G as x,j as m,k as U,aT as w,o as s,w as d,b as a,l as p,aU as B,a as r,m as k,t as b,i as Z,F as P,e as H,T as de,al as je,am as Be,f as Q,aR as Me,aS as oe,aY as Pe,aW as Ye,bS as xe,aV as qe,bT as Re,bU as Ae,aw as Je,aO as Ee,aP as Xe,aQ as We,bV as He,bW as Ge,bD as Ke,bX as Qe,z as Ze,bY as ea,aX as aa}from"./index-CbyJdw3w.js";import{i as W,l as be,s as ta,c as la,d as sa,h as oa,b as ia,w as ra,e as na,f as da,g as ua,a as ca,_ as re,j as pa,k as ma}from"./index-B5Cb-c6D.js";import{b as fa,s as ue,a as he}from"./index-CdSi96Zj.js";import{c as _a}from"./index-CbiVW7Hl.js";const va={key:0,class:"px-8 py-6"},ga={key:0,class:"grid grid-cols-2 gap-x-4 gap-y-3"},ya={class:"flex flex-col gap-y-2"},xa={key:0,class:"flex flex-col gap-y-2"},ba={key:1,class:"space-y-3"},ha={class:"space-y-3"},ka={class:"flex flex-col gap-2"},wa={class:"text-sm font-bold flex items-center gap-1"},Va={class:"pi pi-question-circle cursor-pointer"},Ca={class:"space-y-2"},za={class:"flex-1 grid grid-cols-2 gap-2"},Na={class:"flex flex-col gap-y-1"},Ta={class:"flex flex-col gap-y-1"},Oa={class:"flex items-center gap-2"},La={class:"flex flex-col gap-y-2"},Da={class:"space-y-4"},Sa={class:"space-y-3"},$a={class:"flex items-center gap-2"},Fa={for:"other-section-toggle",class:"cursor-pointer font-bold text-sm"},Ua={class:"pi pi-question-circle cursor-pointer"},Ia={key:0,class:"space-y-3"},ja={class:"flex flex-col gap-2"},Ba={class:"flex flex-col gap-3"},Ma={class:"flex-1 grid grid-cols-3 gap-2",name:"add_factor_sub_list"},Pa={class:"flex flex-col gap-y-1"},Ya={class:"text-xs text-gray-600 dark:text-gray-400"},qa={class:"flex flex-col gap-y-1"},Ra={class:"flex flex-col gap-y-1"},Aa={class:"flex items-center gap-2"},Ja={class:"flex mt-4"},Ea={class:"flex flex-col gap-y-2"},Xa={class:"grid grid-cols-2 gap-x-4 gap-y-3"},Wa={class:"flex flex-col gap-y-2"},Ha={class:"flex flex-col gap-y-2"},Ga={class:"flex w-full gap-2"},Ka={class:"space-y-3"},Qa={class:"flex flex-col gap-2"},Za={class:"space-y-2"},et={class:"flex-1 grid grid-cols-2 gap-2",name:"add_factor_sub_list"},at={class:"flex flex-col gap-y-1"},tt={class:"text-xs text-gray-600 dark:text-gray-400"},lt={class:"flex flex-col gap-y-1"},st={class:"flex items-center gap-2"},ot={class:"flex"},it={class:"flex flex-col gap-y-2"},rt={key:0,class:"text-red-500 text-sm mb-2"},nt={class:"flex"},dt={class:"flex flex-col gap-y-4"},ut={class:"w-full border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden"},ct={key:0,class:"text-center py-4"},pt={key:1,class:"flex flex-col gap-y-3"},mt={class:"flex flex-col gap-y-2"},ft={key:2,class:"grid grid-cols-2 gap-4"},_t={class:"flex flex-col gap-y-2"},vt={class:"flex flex-col gap-y-2"},gt={class:"flex flex-col gap-y-2"},yt={key:0},xt={class:"flex gap-2"},bt={class:"text-sm flex items-center gap-1"},ht={class:"font-bold"},kt={class:"flex"},wt=ne({__name:"toolInputForm.tmpl",props:{toolName:{},runIsLoading:{type:Boolean}},setup(ee){const A=ye(),C=h("plain"),O=h([]),t=h({main_factor:"",sub_factor:"",factor_dict:[],filter_list:[],mode:"",strategy_info:{strategy_name:0,start_time:void 0,end_time:void 0,add_factor_main_list:[{因子名称:"指数",次坐标轴:!0}],add_factor_sub_list:[]},param_search_info:{param_x:"",param_y:"",evaluation_indicator:"",limit_dict:{}},strategy_results:[]}),T=h(!1),M=h(),J=["K线图","柱状图","折线图"],L=h([]),S=h({add_factor_main_list:"",add_factor_sub_list:""}),v=h(Ie),f=h([]),z=h(),I=h(!1),q=h([]),E=h([]),g=h({factor_dict:"",filter_list:""}),R=[{label:"只用现货",value:"spot"},{label:"只用合约",value:"swap"},{label:"现货和合约都用",value:"spot+swap"}],$=ee,j=h({}),G=ge({get:()=>t.value.strategy_info.start_time?W(t.value.strategy_info.start_time).toDate():void 0,set:l=>{t.value.strategy_info.start_time=l?W(l).format("YYYY-MM-DD"):void 0}}),ae=ge({get:()=>t.value.strategy_info.end_time?W(t.value.strategy_info.end_time).toDate():void 0,set:l=>{t.value.strategy_info.end_time=l?W(l).format("YYYY-MM-DD"):void 0}}),K=()=>{const l=Pe(v.value,t.value);t.value.param_search_info.limit_dict||(t.value.param_search_info.limit_dict={}),l&&typeof l=="object"&&Object.keys(l).forEach(e=>{Object.hasOwn(t.value.param_search_info.limit_dict,e)&&(Array.isArray(t.value.param_search_info.limit_dict[e])?l[e]=t.value.param_search_info.limit_dict[e][0]:l[e]=t.value.param_search_info.limit_dict[e])}),t.value.param_search_info.limit_dict=JSON.parse(JSON.stringify(l))},ke=async()=>{const l=await Re();l.result===!0&&(O.value=l.data||[])},we=async()=>{var e;const l=await Ae();l.result===!0&&(q.value=l.data||[],E.value=(e=l.data)==null?void 0:e.map(u=>u[0]))},ce=async l=>{var u;const e=await xe(l);if(e.result===!0){const c={main_factor:"",sub_factor:"",factor_dict:[],filter_list:[],mode:"",strategy_info:{strategy_name:0,start_time:"",end_time:"",add_factor_main_list:[{因子名称:"指数",次坐标轴:!0}],add_factor_sub_list:[]},param_search_info:{param_x:"",param_y:"",limit_dict:{},evaluation_indicator:""},strategy_results:[]},y=JSON.parse(JSON.stringify(e.data||{}));t.value={...c,...y,param_search_info:{...c.param_search_info,...y.param_search_info||{},limit_dict:((u=y.param_search_info)==null?void 0:u.limit_dict)||{}}},$.toolName===w.tool2&&(t.value.param_search_info&&t.value.param_search_info.param_x&&t.value.param_search_info.param_y?C.value="heatmap":C.value="plain",z.value=qe(v.value),K()),(w.tool1===$.toolName||U==="stock")&&(ke(),we(),t.value.filter_list&&t.value.filter_list.length>0&&(I.value=!0))}};ie(()=>$.toolName,async l=>{if(S.value={add_factor_main_list:"",add_factor_sub_list:""},g.value={factor_dict:"",filter_list:""},L.value=[],l===w.tool2){let e=We;const u=await Je("config");if(u.result===!0&&u.data){v.value=JSON.parse(JSON.stringify(u.data));let c=u.data.strategy_info,y=JSON.parse(JSON.stringify(u.data));Object.keys(y).map(V=>{V.includes("[")&&y[V]!==null?L.value.push({label:Ee(Xe(V),c,!1),value:V}):!["name","search_name","strategy_info"].includes(V)&&y[V]!==null&&L.value.push({label:e[V]||V,value:V})})}}if(ce(l),M.value=[],f.value=[],l===w.tool4||l===w.tool5){const e=await He();e.result===!0&&(f.value=e.data)}if(j.value={},l===w.tool1){const e=await Ge();e.result===!0&&e.data&&(j.value=e.data)}},{immediate:!0}),ie(()=>C.value,l=>{l==="plain"&&(t.value.param_search_info.param_y=""),K()});const Ve=async({values:l})=>{var u;const e={};if(g.value={factor_dict:"",filter_list:""},t.value.mode||(e.mode=[{message:"请选择模式"}]),$.toolName===w.tool1&&t.value.factor_dict&&t.value.factor_dict.length===0&&(g.value.factor_dict="至少配置一个策略因子"),$.toolName===w.tool1&&t.value.factor_dict&&t.value.factor_dict.length>0)for(const c of t.value.factor_dict){if(!c.factor){g.value.factor_dict="添加的因子名称不能为空";break}if(!c.params||c.params.length===0){g.value.factor_dict="请选择因子参数";break}}if(t.value.filter_list&&t.value.filter_list.length>0)for(const c of t.value.filter_list){if(!c[0]){g.value.filter_list="添加的因子名称不能为空";break}const y=/^(pct|rank|val):([<>]=?|==|!=|<=|>=)\s*(.+)$/;if(!((u=c[2])!=null&&u.match(y))){g.value.filter_list="因子使用条件不正确，需要以 pct:, rank:, val: 开头，中间是判断运算符的字符串";break}}return{values:l,errors:e}},Ce=l=>{l===!1&&(t.value.filter_list=[])},ze=async({values:l})=>{var y;const e={};(t.value.strategy_info.strategy_name===""||t.value.strategy_info.strategy_name===null)&&(e.strategy_name=[{message:"策略名称不能为空"}]),t.value.strategy_info.start_time||(e.start_time=[{message:"分析开始时间不能为空"}]),t.value.strategy_info.end_time||(e.end_time=[{message:"分析结束时间不能为空"}]),S.value={add_factor_main_list:"",add_factor_sub_list:""};const u=t.value.strategy_info.add_factor_sub_list.map(V=>{var X;return((X=V.因子名称)==null?void 0:X[0])||""});if(u.filter((V,X)=>u.indexOf(V)!==X).length>0&&(S.value.add_factor_sub_list="因子名称不能重复"),t.value.strategy_info.add_factor_sub_list.length>0)for(const V of t.value.strategy_info.add_factor_sub_list){if(V.因子名称&&((y=V.因子名称)==null?void 0:y[0])===""){S.value.add_factor_sub_list="添加的因子名称不能为空";break}if(V.图形样式===""){S.value.add_factor_sub_list="添加的因子图形样式不能为空";break}}return{values:l,errors:e}},Ne=async({values:l})=>{const e={};t.value.param_search_info.param_x||(e.param_x=[{message:"分析参数是必选项"}]),t.value.param_search_info.evaluation_indicator||(e.evaluation_indicator=[{message:"分析指标是必选项"}]),C.value==="heatmap"?(t.value.param_search_info.param_y||(e.param_y=[{message:"Y轴参数是必选项"}]),t.value.param_search_info.param_x&&t.value.param_search_info.param_y&&t.value.param_search_info.param_x===t.value.param_search_info.param_y&&(e.param_x=[{message:"X轴和Y轴参数不能相同"}],e.param_y=[{message:"X轴和Y轴参数不能相同"}])):t.value.param_search_info.param_y="";const u=t.value.param_search_info.limit_dict;return u&&Object.entries(u).forEach(([c,y])=>{y||(e[`${c}`]=[{message:`请为${oe(c,v.value.strategy_info)}选择一个固定值`}])}),{values:l,errors:e}},Te=async({values:l})=>{const e={};return(!t.value.strategy_results||t.value.strategy_results.length===0)&&(e.strategy_results=[{message:"回测策略名称至少选择一个"}]),{values:l,errors:e}},te=async({valid:l})=>{if(l){if(w.tool1===$.toolName&&(g.value.factor_dict||g.value.filter_list))return;T.value=!0;const e=await Ye($.toolName,t.value);T.value=!1,e.result===!0&&(A.add({severity:"success",summary:"保存成功！",life:3e3}),ce($.toolName))}},Oe=(l,e)=>{var u;t.value.filter_list&&t.value.filter_list.length>0&&(t.value.filter_list[e][1]=((u=q.value.find(c=>c[0]===l))==null?void 0:u[1])||null)},pe=h(""),Le=l=>j.value[l]||[],De=(l,e)=>{t.value.factor_dict[e].params=[]};return(l,e)=>{const u=la,c=fa,y=ue,V=sa,X=oa,me=ia,le=ta,fe=ra,_e=ua,Se=da,$e=na,Fe=he,Ue=be,ve=de;return m(U)==="coin"&&m(w).tool3===l.toolName?(s(),n("div",va," 功能开发中，敬请期待！ ")):(s(),x(Ue,{key:1,class:"mx-5 my-5 border-1 border-gray-100 dark:border-neutral-700",pt:{body:{class:"pt-0"}}},{content:d(()=>[e[49]||(e[49]=a("div",{class:"font-semibold py-3"},"配置参数",-1)),e[50]||(e[50]=a("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"配置参数保存成功后方可运行并获取分析结果",-1)),l.toolName===m(B).tool1||l.toolName===m(B).tool2||l.toolName===m(w).tool1?(s(),x(le,{key:0,resolver:Ve,onSubmit:te,class:"flex-1 flex flex-col space-y-4 mt-3"},{default:d(_=>{var F,D,Y;return[l.toolName===m(B).tool1||l.toolName===m(B).tool2?(s(),n("div",ga,[a("div",ya,[e[16]||(e[16]=a("label",{class:"text-sm flex items-center gap-1"},[a("span",{class:"text-red-500"},"*"),a("span",{class:"font-bold"},"因子1")],-1)),r(u,{size:"small",name:"main_factor",modelValue:t.value.main_factor,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.main_factor=o),options:O.value,placeholder:"请选择因子",checkmark:"",highlightOnSelect:!1,class:"w-full",showClear:""},null,8,["modelValue","options"]),(F=_.main_factor)!=null&&F.invalid?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>{var o;return[k(b((o=_.main_factor.error)==null?void 0:o.message),1)]}),_:2},1024)):p("",!0)]),l.toolName==="tool2_双因子分析"?(s(),n("div",xa,[e[17]||(e[17]=a("label",{class:"text-sm flex items-center gap-1"},[a("span",{class:"text-red-500"},"*"),a("span",{class:"font-bold"},"因子2")],-1)),r(u,{size:"small",name:"sub_factor",modelValue:t.value.sub_factor,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.sub_factor=o),options:O.value.filter(o=>o!==t.value.main_factor),placeholder:"请选择因子",checkmark:"",highlightOnSelect:!1,class:"w-full",showClear:""},null,8,["modelValue","options"]),(D=_.sub_factor)!=null&&D.invalid?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>{var o;return[k(b((o=_.sub_factor.error)==null?void 0:o.message),1)]}),_:2},1024)):p("",!0)])):p("",!0)])):(s(),n("div",ba,[a("div",ha,[a("div",ka,[a("label",wa,[e[18]||(e[18]=a("span",{class:"text-red-500"},"*",-1)),e[19]||(e[19]=a("span",null,"策略因子配置",-1)),Z(a("i",Va,null,512),[[ve,{value:"1.选择策略因子及每个因子对应的参数，支持单参数和多参数<br/>2.原始分箱图分组排序默认从小到大，即第一组为因子值最小的一组，最后一组为因子值最大的一组",autoHide:!1,escape:!1,class:"min-w-88"},void 0,{bottom:!0}]])]),r(y,{size:"small",variant:"outlined",icon:"pi pi-plus",label:"添加策略因子配置",onClick:e[2]||(e[2]=()=>{t.value.factor_dict||(t.value.factor_dict=[]),t.value.factor_dict.push({factor:"",params:[]})})})]),a("div",Ca,[(s(!0),n(P,null,H(t.value.factor_dict,(o,i)=>(s(),n("div",{key:i,class:"flex items-center gap-2 p-3 bg-white dark:bg-neutral-700/50 rounded-md border-1 border-gray-300/50 dark:border-0"},[a("div",za,[a("div",Na,[e[20]||(e[20]=a("label",{class:"text-xs text-gray-600 dark:text-gray-400"},"选择因子",-1)),r(u,{modelValue:o.factor,"onUpdate:modelValue":N=>o.factor=N,options:Object.keys(j.value),placeholder:"选择因子",class:"w-full",onValueChange:N=>De(N,i)},null,8,["modelValue","onUpdate:modelValue","options","onValueChange"])]),a("div",Ta,[e[21]||(e[21]=a("label",{class:"text-xs text-gray-600 dark:text-gray-400"},"因子参数(多选)",-1)),a("div",Oa,[r(V,{modelValue:o.params,"onUpdate:modelValue":N=>o.params=N,size:"small",options:Le(o.factor),placeholder:"选择参数",class:"w-full",display:"chip"},null,8,["modelValue","onUpdate:modelValue","options"]),r(y,{size:"small",variant:"text",icon:"pi pi-trash",severity:"danger",onClick:()=>{t.value.factor_dict&&t.value.factor_dict.splice(i,1)}},null,8,["onClick"])])])])]))),128)),g.value.factor_dict?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>[k(b(g.value.factor_dict),1)]),_:1})):p("",!0)])]),a("div",La,[e[22]||(e[22]=a("label",{class:"text-sm flex items-center gap-1"},[a("span",{class:"text-red-500"},"*"),a("span",{class:"font-bold"},"数据模式")],-1)),r(u,{size:"small",name:"mode",modelValue:t.value.mode,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.mode=o),options:R,optionLabel:"label",optionValue:"value",placeholder:"请选择数据模式",checkmark:"",highlightOnSelect:!1,class:"w-full",showClear:""},null,8,["modelValue"]),(Y=_.mode)!=null&&Y.invalid?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>{var o;return[k(b((o=_.mode.error)==null?void 0:o.message),1)]}),_:2},1024)):p("",!0)]),pe.value?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>[k(b(pe.value),1)]),_:1})):p("",!0)])),a("div",Da,[a("div",Sa,[a("div",$a,[r(X,{modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=o=>I.value=o),inputId:"other-section-toggle","aria-label":"分域配置启用开关",onValueChange:Ce},null,8,["modelValue"]),a("label",Fa,b(I.value?"已启用分域配置":"未启用分域配置"),1),Z(a("i",Ua,null,512),[[ve,{value:`${m(U)==="coin"?m(je):m(Be)}`,autoHide:!1,escape:!1,class:"min-w-150"}]])]),r(c,{icon:"pi pi-exclamation-triangle",size:"small",severity:"warn"},{default:d(()=>e[23]||(e[23]=[k(" 使用该功能前，请确保在策略管理页面的当前配置中设置分域因子并完成回测，否则因子下拉列表为空，功能不可用。 ")])),_:1,__:[23]})]),I.value?(s(),n("div",Ia,[a("div",ja,[e[24]||(e[24]=a("label",{class:"text-sm font-bold flex items-center gap-1"},[a("span",null,"分域配置")],-1)),r(y,{size:"small",variant:"outlined",icon:"pi pi-plus",label:"添加分域",onClick:e[5]||(e[5]=()=>{t.value.filter_list||(t.value.filter_list=[]),t.value.filter_list.push(["",null,""])})})]),a("div",Ba,[e[27]||(e[27]=a("span",{class:"text-xs text-gray-600 flex items-center gap-1"},[a("i",{class:"pi pi-info-circle text-xs"}),k(" 因子使用条件需要以 pct: 或 rank: 或 val: 开头，中间是判断运算符的字符串，最后是数值，例如rank:>1")],-1)),(s(!0),n(P,null,H(t.value.filter_list,(o,i)=>(s(),n("div",{key:i,class:"flex items-center gap-2 p-3 bg-white dark:bg-neutral-700/50 rounded-md border-1 border-gray-300/50 dark:border-0"},[a("div",Ma,[a("div",Pa,[a("label",Ya,"因子"+b(i+1),1),r(u,{size:"small",modelValue:o[0],"onUpdate:modelValue":N=>o[0]=N,options:E.value,placeholder:"选择因子",class:"w-full",onValueChange:N=>Oe(N,i)},null,8,["modelValue","onUpdate:modelValue","options","onValueChange"])]),a("div",qa,[e[25]||(e[25]=a("label",{class:"text-xs text-gray-600 dark:text-gray-400"},"因子参数",-1)),r(me,{modelValue:o[1],size:"small",disabled:""},null,8,["modelValue"])]),a("div",Ra,[e[26]||(e[26]=a("label",{class:"text-xs text-gray-600 dark:text-gray-400"},"因子使用条件 ",-1)),a("div",Aa,[r(me,{modelValue:o[2],"onUpdate:modelValue":N=>o[2]=N,type:"text",placeholder:"例如：rank:>1",size:"small",fluid:"",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),r(y,{size:"small",variant:"text",icon:"pi pi-trash",severity:"danger",onClick:()=>{t.value.filter_list&&t.value.filter_list.splice(i,1)}},null,8,["onClick"])])])])]))),128))])])):p("",!0),g.value.filter_list?(s(),x(c,{key:1,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>[k(b(g.value.filter_list),1)]),_:1})):p("",!0)]),a("div",Ja,[r(y,{type:"submit",size:"small",variant:"outlined",disabled:l.runIsLoading,loading:T.value},{default:d(()=>e[28]||(e[28]=[k("保存")])),_:1,__:[28]},8,["disabled","loading"])])]}),_:1})):p("",!0),m(U)==="stock"?(s(),n(P,{key:1},[l.toolName===m(B).tool3?(s(),x(le,{key:0,resolver:ze,onSubmit:te,class:"flex-1 flex flex-col space-y-3 mt-3"},{default:d(_=>{var F,D,Y;return[a("div",Ea,[e[29]||(e[29]=a("label",{class:"text-sm flex items-center gap-1"},[a("span",{class:"text-red-500"},"*"),a("span",{class:"font-bold"},"策略名称")],-1)),r(u,{size:"small",name:"strategy_name",modelValue:t.value.strategy_info.strategy_name,"onUpdate:modelValue":e[6]||(e[6]=o=>t.value.strategy_info.strategy_name=o),options:M.value,optionLabel:"label",optionValue:"value",placeholder:"请选择策略",checkmark:"",highlightOnSelect:!1,class:"w-full",showClear:""},null,8,["modelValue","options"]),(F=_.strategy_name)!=null&&F.invalid?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>{var o;return[k(b((o=_.strategy_name.error)==null?void 0:o.message),1)]}),_:2},1024)):p("",!0)]),a("div",Xa,[a("div",Wa,[e[30]||(e[30]=a("label",{class:"text-sm space-x-1"},[a("span",{class:"text-red-500"},"*"),a("span",{class:"font-bold"},"分析开始时间"),a("span",{class:"text-xs text-gray-500 dark:text-gray-300"})],-1)),r(fe,{id:"start_time",name:"start_time",modelValue:G.value,"onUpdate:modelValue":e[7]||(e[7]=o=>G.value=o),dateFormat:"yy-mm-dd",size:"small",placeholder:"请选择分析开始时间（要小于分析结束时间）",maxDate:ae.value?m(W)(ae.value).subtract(1,"day").toDate():void 0},null,8,["modelValue","maxDate"]),e[31]||(e[31]=a("span",{class:"text-xs text-gray-500 dark:text-gray-300 ml-1"}," 提示：请确保分析开始时间 ≥ 回测的开始时间，否则会导致回测之前的分析数据缺失 ",-1)),(D=_.start_time)!=null&&D.invalid?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>{var o;return[k(b((o=_.start_time.error)==null?void 0:o.message),1)]}),_:2},1024)):p("",!0)]),a("div",Ha,[e[32]||(e[32]=a("label",{class:"text-sm space-x-1"},[a("span",{class:"text-red-500"},"*"),a("span",{class:"font-bold"},"分析结束时间"),a("span",{class:"text-xs text-gray-500 dark:text-gray-300"})],-1)),a("div",Ga,[r(fe,{id:"end_time",name:"end_time",modelValue:ae.value,"onUpdate:modelValue":e[8]||(e[8]=o=>ae.value=o),dateFormat:"yy-mm-dd",size:"small",placeholder:"请选择分析结束时间（要大于分析开始时间）",minDate:G.value?m(W)(G.value).add(1,"day").toDate():void 0,class:"flex-1"},null,8,["modelValue","minDate"])]),e[33]||(e[33]=a("span",{class:"text-xs text-gray-500 dark:text-gray-300 ml-1"}," 提示：请确保分析结束时间 ≤ 跑回测的结束时间，否则会导致回测之后的分析数据缺失 ",-1)),(Y=_.end_time)!=null&&Y.invalid?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>{var o;return[k(b((o=_.end_time.error)==null?void 0:o.message),1)]}),_:2},1024)):p("",!0)])]),a("div",null,[a("div",Ka,[a("div",Qa,[e[34]||(e[34]=a("label",{class:"text-sm font-bold flex items-center gap-1"},[a("span",null,"因子配置")],-1)),r(y,{size:"small",variant:"outlined",icon:"pi pi-plus",label:"添加因子",onClick:e[9]||(e[9]=()=>{t.value.strategy_info.add_factor_sub_list.push({因子名称:[""],图形样式:""})})})]),a("div",Za,[(s(!0),n(P,null,H(t.value.strategy_info.add_factor_sub_list,(o,i)=>(s(),n("div",{key:i,class:"flex items-center gap-2 p-3 bg-white dark:bg-neutral-700/50 rounded-md border-1 border-gray-300/50 dark:border-0"},[a("div",et,[a("div",at,[a("label",tt,"因子"+b(i+1),1),r(u,{size:"small",modelValue:o.因子名称[0],"onUpdate:modelValue":N=>o.因子名称[0]=N,options:O.value,placeholder:"选择因子",class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options"])]),a("div",lt,[e[35]||(e[35]=a("label",{class:"text-xs text-gray-600 dark:text-gray-400"},"图形样式",-1)),a("div",st,[r(u,{size:"small",modelValue:o.图形样式,"onUpdate:modelValue":N=>o.图形样式=N,options:J,placeholder:"选择图形样式",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),r(y,{size:"small",variant:"text",icon:"pi pi-trash",severity:"danger",onClick:()=>{t.value.strategy_info.add_factor_sub_list.splice(i,1)}},null,8,["onClick"])])])])]))),128)),S.value.add_factor_sub_list?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>[k(b(S.value.add_factor_sub_list),1)]),_:1})):p("",!0)])])]),a("div",ot,[r(y,{type:"submit",size:"small",variant:"outlined",disabled:l.runIsLoading,loading:T.value},{default:d(()=>e[36]||(e[36]=[k("保存")])),_:1,__:[36]},8,["disabled","loading"])])]}),_:1})):p("",!0)],64)):m(U)==="coin"?(s(),n(P,{key:2},[l.toolName===m(w).tool4||l.toolName===m(w).tool5?(s(),x(le,{key:0,resolver:Te,onSubmit:te,class:"flex-1 flex flex-col space-y-4 mt-3"},{default:d(_=>{var F;return[a("div",it,[f.value.length===0?(s(),n("div",rt," 当前暂无回测结果，请先在 PyCharm 启动回测，或前往策略管理页面执行「一键回测」 ")):p("",!0),e[37]||(e[37]=a("label",{class:"text-sm flex items-center gap-1"},[a("span",{class:"text-red-500"},"*"),a("span",{class:"font-bold"},"回测策略名称(多选)")],-1)),r(V,{size:"small",name:"strategy_results",modelValue:t.value.strategy_results,"onUpdate:modelValue":e[10]||(e[10]=D=>t.value.strategy_results=D),options:f.value,filter:"",placeholder:"请选择回测策略名称（可多选）",maxSelectedLabels:4,selectedItemsLabel:"{0} 个策略已选择",class:"w-full",display:"chip"},null,8,["modelValue","options"]),(F=_.strategy_results)!=null&&F.invalid?(s(),x(c,{key:1,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>{var D;return[k(b((D=_.strategy_results.error)==null?void 0:D.message),1)]}),_:2},1024)):p("",!0)]),a("div",nt,[r(y,{type:"submit",size:"small",variant:"outlined",disabled:l.runIsLoading,loading:T.value},{default:d(()=>e[38]||(e[38]=[k("保存")])),_:1,__:[38]},8,["disabled","loading"])])]}),_:1})):p("",!0)],64)):p("",!0),m(U)==="stock"&&l.toolName===m(B).tool4||m(U)==="coin"&&l.toolName===m(w).tool2?(s(),x(le,{key:3,resolver:Ne,onSubmit:te,class:"flex-1 flex flex-col space-y-3 mt-3"},{default:d(_=>{var F,D,Y,o;return[a("div",dt,[a("div",ut,[r($e,{value:C.value,"onUpdate:value":e[11]||(e[11]=i=>C.value=i),class:"w-full"},{default:d(()=>[r(Se,{class:"flex bg-gray-50 dark:bg-neutral-800"},{default:d(()=>[r(_e,{value:"plain",class:Q(["flex-1 relative",["transition-colors duration-200 py-3 text-sm font-medium",C.value==="plain"?"text-primary-600 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400"]]),pt:{root:"focus:outline-none focus:ring-0"}},{default:d(()=>[e[39]||(e[39]=a("span",{class:"flex items-center justify-center gap-2"}," 单参数平原图 ",-1)),a("div",{class:Q(["absolute bottom-0 left-0 w-full h-0.5 transition-transform duration-200",["bg-primary-600 dark:bg-primary-400",C.value==="plain"?"scale-x-100":"scale-x-0"]])},null,2)]),_:1,__:[39]},8,["class"]),r(_e,{value:"heatmap",class:Q(["flex-1 relative",["transition-colors duration-200 py-3 text-sm font-medium",C.value==="heatmap"?"text-primary-600 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400",L.value.length<=1?"opacity-50 cursor-not-allowed":""]]),disabled:L.value.length<=1,pt:{root:"focus:outline-none focus:ring-0"}},{default:d(()=>[e[40]||(e[40]=a("span",{class:"flex items-center justify-center gap-2"}," 双参数热力图 ",-1)),a("div",{class:Q(["absolute bottom-0 left-0 w-full h-0.5 transition-transform duration-200",["bg-primary-600 dark:bg-primary-400",C.value==="heatmap"?"scale-x-100":"scale-x-0"]])},null,2)]),_:1,__:[40]},8,["class","disabled"])]),_:1})]),_:1},8,["value"])]),L.value.length===0?(s(),n("div",ct,e[41]||(e[41]=[a("div",{class:"text-red-500 text-sm mb-2"}," 未启用遍历配置，或已启用的遍历配置未配置参数 ",-1),a("div",{class:"text-gray-500 text-xs"},"请先在遍历配置中设置参数",-1)]))):C.value==="plain"?(s(),n("div",pt,[a("div",mt,[e[42]||(e[42]=a("label",{class:"text-sm flex items-center gap-1"},[a("span",{class:"text-red-500"},"*"),a("span",{class:"font-bold"},"分析参数")],-1)),r(u,{size:"small",name:"param_x",modelValue:t.value.param_search_info.param_x,"onUpdate:modelValue":e[12]||(e[12]=i=>t.value.param_search_info.param_x=i),options:L.value,optionLabel:"label",optionValue:"value",placeholder:"请选择要分析的参数",class:"w-full",showClear:!0,onValueChange:K},null,8,["modelValue","options"]),(F=_.param_x)!=null&&F.invalid?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>{var i;return[k(b((i=_.param_x.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)])])):C.value==="heatmap"?(s(),n("div",ft,[a("div",_t,[e[43]||(e[43]=a("label",{class:"text-sm flex items-center gap-1"},[a("span",{class:"text-red-500"},"*"),a("span",{class:"font-bold"},"X轴参数")],-1)),r(u,{size:"small",name:"param_x",modelValue:t.value.param_search_info.param_x,"onUpdate:modelValue":e[13]||(e[13]=i=>t.value.param_search_info.param_x=i),options:L.value,optionLabel:"label",optionValue:"value",placeholder:"请选择X轴参数",class:"w-full",showClear:!0,onValueChange:K},null,8,["modelValue","options"]),(D=_.param_x)!=null&&D.invalid?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>{var i;return[k(b((i=_.param_x.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)]),a("div",vt,[e[44]||(e[44]=a("label",{class:"text-sm flex items-center gap-1"},[a("span",{class:"text-red-500"},"*"),a("span",{class:"font-bold"},"Y轴参数")],-1)),r(u,{size:"small",name:"param_y",modelValue:t.value.param_search_info.param_y,"onUpdate:modelValue":e[14]||(e[14]=i=>t.value.param_search_info.param_y=i),options:L.value.filter(i=>i.value!==t.value.param_search_info.param_x),optionLabel:"label",optionValue:"value",placeholder:"请选择Y轴参数",class:"w-full",showClear:!0,onValueChange:K},null,8,["modelValue","options"]),(Y=_.param_y)!=null&&Y.invalid?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>{var i;return[k(b((i=_.param_y.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)])])):p("",!0)]),L.value.length>0?(s(),n(P,{key:0},[a("div",gt,[e[45]||(e[45]=a("label",{class:"text-sm flex items-center gap-1"},[a("span",{class:"text-red-500"},"*"),a("span",{class:"font-bold"},"分析指标")],-1)),r(u,{size:"small",name:"evaluation_indicator",modelValue:t.value.param_search_info.evaluation_indicator,"onUpdate:modelValue":e[15]||(e[15]=i=>t.value.param_search_info.evaluation_indicator=i),options:m(Me),placeholder:"请选择分析指标",checkmark:"",filter:"",highlightOnSelect:!1,class:"w-full",showClear:""},null,8,["modelValue","options"]),(o=_.evaluation_indicator)!=null&&o.invalid?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>{var i;return[k(b((i=_.evaluation_indicator.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)]),t.value.param_search_info.limit_dict&&Object.keys(t.value.param_search_info.limit_dict).length>0?(s(),n("div",yt,[r(Fe),e[47]||(e[47]=a("div",{class:"flex items-center gap-2 mb-3"},[a("span",{class:"font-semibold text-gray-700 dark:text-gray-300"},"固定参数设置"),a("span",{class:"text-xs text-gray-500"},"(请为其他参数选择固定值)")],-1)),a("div",xt,[(s(!0),n(P,null,H(Object.keys(t.value.param_search_info.limit_dict),i=>{var N;return s(),n("div",{class:"flex flex-col gap-y-2 w-full",key:i},[a("label",bt,[e[46]||(e[46]=a("span",{class:"text-red-500"},"*",-1)),a("span",ht,b(m(oe)(i,v.value.strategy_info)),1)]),r(u,{size:"small",name:i,modelValue:t.value.param_search_info.limit_dict[i],"onUpdate:modelValue":se=>t.value.param_search_info.limit_dict[i]=se,options:z.value[i],placeholder:`请选择${m(oe)(i,v.value.strategy_info)}的固定值`,class:"w-full",showClear:!0},null,8,["name","modelValue","onUpdate:modelValue","options","placeholder"]),(N=_[i])!=null&&N.invalid?(s(),x(c,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:d(()=>{var se;return[k(b((se=_[i].error)==null?void 0:se.message),1)]}),_:2},1024)):p("",!0)])}),128))])])):p("",!0),a("div",kt,[r(y,{type:"submit",size:"small",variant:"outlined",disabled:l.runIsLoading,loading:T.value},{default:d(()=>e[48]||(e[48]=[k("保存")])),_:1,__:[48]},8,["disabled","loading"])])],64)):p("",!0)]}),_:1})):p("",!0)]),_:1}))}}}),Vt={key:0,class:"flex-1 px-5 py-2 flex flex-col gap-y-6"},Ct={key:0,class:"flex-1 flex flex-col items-center justify-center gap-2"},zt={key:1,class:"flex-1"},Nt={key:0,class:"h-full space-y-4"},Tt={class:"space-y-3"},Ot={key:0},Lt={class:"text-sm text-gray-600 dark:text-gray-400"},Dt=["src"],St={key:1,class:"h-full flex flex-col items-center justify-center gap-4 py-4"},$t=ne({__name:"toolOutput.tmpl",props:{toolName:{}},setup(ee,{expose:A}){const C=ee,O=h(!1),t=h([]),T=h({}),M=async v=>{if(!v)return;O.value=!0;const f=await Qe(v);O.value=!1,f.result===!0&&(f.data?(t.value=f.data,T.value={}):(t.value=[],T.value={}))};ie(()=>C.toolName,v=>{v&&M(v)},{immediate:!0});const J=v=>{T.value[v]=!T.value[v]},L=v=>{v&&window.open(v,"_blank")},S=v=>{if(!v)return"";const f=new Date().getTime(),z=v.includes("?")?"&":"?";return`${v}${z}_t=${f}`};return A({loadToolAnalysisInfo:M}),(v,f)=>{const z=_a,I=ue,q=ca,E=de;return m(U)==="coin"&&m(w).tool3===v.toolName?p("",!0):(s(),n("div",Vt,[f[3]||(f[3]=a("div",{class:"font-semibold"},"分析结果",-1)),O.value?(s(),n("div",Ct,[r(z),f[0]||(f[0]=a("span",{class:"ml-2 text-gray-500 text-sm"},"加载中...",-1))])):(s(),n("div",zt,[t.value.length>0?(s(),n("div",Nt,[(s(!0),n(P,null,H(t.value,(g,R)=>(s(),x(q,{key:g.name+R,header:g.name,toggleable:"",collapsed:T.value[R]===!0,onToggle:()=>J(R)},{icons:d(()=>[g.full_path?Z((s(),x(I,{key:0,size:"small",variant:"text",icon:"pi pi-external-link",onClick:Ke($=>L(S(g.html)),["stop"])},null,8,["onClick"])),[[E,"在新标签打开",void 0,{top:!0}]]):p("",!0)]),default:d(()=>[a("div",Tt,[g.full_path?(s(),n("div",Ot,[f[1]||(f[1]=a("span",{class:"text-sm font-semibold"},"本地存储地址：",-1)),a("span",Lt,b(g.full_path),1)])):p("",!0),g.html?(s(),n("iframe",{key:1,src:S(g.html),width:"100%",frameborder:"0",title:"分析结果展示",class:"min-h-[600px]"},null,8,Dt)):p("",!0)])]),_:2},1032,["header","collapsed","onToggle"]))),128))])):(s(),n("div",St,f[2]||(f[2]=[a("img",{src:re,class:"w-40 h-auto"},null,-1),a("span",{class:"text-gray-500 text-sm"},"暂无分析结果",-1)])))]))]))}}}),Ft={class:"flex items-center justify-between py-3 pl-4 pr-1"},Ut={class:"space-x-1"},It={class:"flex-1 overflow-y-auto"},jt={key:0,class:"space-y-1"},Bt=["onClick"],Mt={class:"flex-1 truncate"},Pt={key:1,class:"h-full flex flex-col items-center pt-30 gap-4"},Yt={key:0,class:"flex-1 min-w-0 h-full flex flex-col relative"},qt={class:"px-4 h-[59px] flex justify-between items-center sticky left-0 top-0"},Rt={class:"flex flex-col justify-center gap-1"},At={class:"font-semibold text-sm"},Jt={class:"text-xs"},Et=["href"],Xt={key:1},Wt={class:"flex-1 flex flex-col overflow-y-auto overflow-x-hidden"},Ht={key:1,class:"flex-1 min-w-0 h-full flex flex-col justify-center items-center gap-4"},el=ne({__name:"tool.page",setup(ee){const A=ye(),C=h(null),O=h([]),t=h(""),T=h(!1),M=h(!1),J={stock:{[B.tool1]:"https://www.quantclass.cn/online-player/67ea6073439532bed6a910d8",[B.tool2]:"https://www.quantclass.cn/online-player/67ed0cc0439532bed6a92d3a",[B.tool3]:"https://www.quantclass.cn/online-player/683983a86f9bf2ccf0e2f4b0",[B.tool4]:"https://www.quantclass.cn/online-player/683983a86f9bf2ccf0e2f4b0"},coin:{[w.tool2]:"https://www.quantclass.cn/online-player/67d7fa20df1ef61e00afa2c0",[w.tool1]:"https://www.quantclass.cn/online-player/67e22ac007978973f320e23e",[w.tool3]:"https://www.quantclass.cn/online-player/67e22ac007978973f320e23e",[w.tool4]:"https://www.quantclass.cn/online-player/67e22ac007978973f320e23e",[w.tool5]:"https://www.quantclass.cn/online-player/67e22ac007978973f320e23e"}};Ze(async()=>{const f=await ea();f.result===!0&&(O.value=f.data||[],O.value.length>0&&L(O.value[0]))});const L=f=>{t.value=f,M.value=!1},S=async f=>{const z=await xe(f);z.result===!0&&(z.data||(M.value=!0))},v=async()=>{if(await S(t.value),M.value){A.add({severity:"warn",summary:"请先填写配置参数并保存后再点击运行",life:3e3});return}T.value=!0;const f=await aa(t.value);T.value=!1,f.result===!0&&(A.add({severity:"success",summary:"运行成功！",life:3e3}),C.value&&C.value.loadToolAnalysisInfo(t.value))};return(f,z)=>{const I=ue,q=he,E=be,g=ma,R=pa,$=de;return s(),x(R,{class:"w-full h-screen overflow-hidden flex"},{default:d(()=>[r(g,{size:18,class:"min-w-[232px]"},{default:d(()=>[r(E,{class:"max-h-full border-0 rounded-none shadow-none",pt:{body:{class:"flex-1 p-0 pb-2 min-h-0"},content:{class:"h-full min-h-0 flex flex-col"}}},{header:d(()=>[a("div",Ft,[z[0]||(z[0]=a("span",{class:"font-semibold"},"工具库",-1)),a("div",Ut,[Z(r(I,{icon:"pi pi-plus",variant:"outlined",size:"small",severity:"secondary",disabled:""},null,512),[[$,"未来可导入论坛里的工具",void 0,{left:!0}]])])])]),content:d(()=>[r(q,{class:"m-0"}),a("div",It,[O.value.length>0?(s(),n("ul",jt,[(s(!0),n(P,null,H(O.value,j=>(s(),n("li",{onClick:G=>L(j),key:j,class:Q(["h-11 flex justify-between items-center gap-2 font-medium text-sm cursor-pointer pl-4 pr-1 py-2 hover:bg-primary-50 text-gray-700 hover:text-primary-600 dark:bg-neutral-900 dark:hover:bg-primary-900 dark:text-gray-300 dark:hover:text-primary-100",t.value===j?"text-primary-600 bg-primary-50 dark:text-primary-100 dark:bg-primary-900":""])},[Z((s(),n("span",Mt,[k(b(j),1)])),[[$,j]])],10,Bt))),128))])):(s(),n("div",Pt,z[1]||(z[1]=[a("img",{src:re,class:"w-30 h-auto"},null,-1),a("div",{class:"space-y-1 flex flex-col items-center"},[a("span",{class:"text-gray-500 text-sm"},"暂无工具")],-1)])))])]),_:1})]),_:1}),r(g,{size:82},{default:d(()=>[O.value.length>0?(s(),n("div",Yt,[a("div",qt,[a("div",Rt,[a("span",At,b(t.value),1),a("div",Jt,[z[2]||(z[2]=a("span",{class:"text-gray-600 dark:text-gray-200"},"直播链接：",-1)),t.value?(s(),n("a",{key:0,href:J[m(U)][t.value],target:"_blank",class:"text-primary-500 hover:underline"},b(J[m(U)][t.value]),9,Et)):(s(),n("span",Xt,"--"))])]),m(U)==="coin"&&m(w).tool3===t.value?p("",!0):(s(),x(I,{key:0,icon:"pi pi-caret-right",label:"运行",size:"small",onClick:v,class:"ring",loading:T.value},null,8,["loading"]))]),r(q,{class:"m-0"}),a("div",Wt,[r(wt,{toolName:t.value,runIsLoading:T.value},null,8,["toolName","runIsLoading"]),r($t,{ref_key:"refToolOutputTmpl",ref:C,toolName:t.value},null,8,["toolName"])])])):(s(),n("div",Ht,z[3]||(z[3]=[a("img",{src:re,class:"w-30 h-auto"},null,-1),a("span",{class:"text-gray-500 text-sm"},"暂无信息",-1)])))]),_:1})]),_:1})}}});export{el as default};
