import{d as at,a7 as ot,ae as it,r as d,af as Lt,h as Gt,g as Ze,ag as X,c,o as a,F as S,a as o,w as u,b as l,G as y,l as p,j as m,k as C,f as tt,m as g,t as _,ah as je,i as k,T as nt,ai as Tt,aj as zt,ak as Ut,e as $e,v as Kt,al as Zt,am as Qt,an as Ke,ao as Se,ap as Mt,aq as Vt,ar as jt,as as lt,at as Ae,z as At,au as Xt,av as el,aw as tl,ax as ll,ay as sl,az as al,a8 as ol,aA as il,E as nl,aB as rl,aC as ul,aD as cl,aE as fl,aF as dl,aG as vl}from"./index-CbyJdw3w.js";import{s as pl,_ as We,a as ml,b as _l,c as Et,d as gl,e as fe,f as Ht,g as Nt,h as qt,i as yl,j as xl,k as Jt,l as et,m as Pt,n as bl,o as hl,p as kl,q as wl,U as Cl,r as $l,t as Sl,u as Dl,v as Ol}from"./uploadConfigDialog.tmpl-Ba7xXsGA.js";import{c as Il}from"./index-CbiVW7Hl.js";import{s as Ll,a as Vl,b as rt,c as Bt,d as Nl,e as Fl,f as Tl,g as zl,h as Ul,i as st,_ as Ft,j as Ml,k as jl,l as Al}from"./index-B5Cb-c6D.js";import{a as Rt}from"./index-DAnG4PUT.js";import{b as Wt,s as ut,a as Yt}from"./index-CdSi96Zj.js";import{s as El}from"./index-CPBIGXVz.js";const Hl={class:"space-x-2"},ql={class:"w-full flex-1 flex flex-col gap-y-5"},Jl={class:"flex gap-x-2"},Pl={class:"flex-1 flex flex-col gap-y-2"},Bl={class:"text-sm space-x-1 flex items-center"},Rl={class:"pi pi-question-circle cursor-pointer"},Wl={class:"flex gap-x-2"},Yl={class:"flex-1 flex flex-col gap-y-2"},Gl={class:"text-sm space-x-1"},Kl={class:"pi pi-question-circle cursor-pointer"},Zl={class:"flex-1 flex flex-col gap-y-2"},Ql={class:"text-sm space-x-1 flex items-center"},Xl={class:"pi pi-question-circle cursor-pointer"},es={class:"flex flex-col gap-y-2"},ts={class:"text-sm flex items-center gap-1"},ls={class:"pi pi-question-circle cursor-pointer"},ss={class:"text-xs text-gray-500 dark:text-gray-300 ml-2"},as={class:"flex flex-col gap-y-2"},os={class:"text-sm flex items-center gap-1"},is={class:"pi pi-question-circle cursor-pointer"},ns={key:0,class:"text-xs text-primary-500"},rs={class:"flex items-center gap-2"},us={class:"flex flex-1 gap-4 items-center"},cs={class:"text-gray-500 dark:text-gray-300"},fs={class:"text-gray-500 dark:text-gray-300 ml-2"},ds={class:"flex items-center gap-x-2"},vs={class:"flex-1 flex flex-col gap-y-2"},ps={class:"text-sm space-x-1 flex items-center"},ms={class:"pi pi-question-circle cursor-pointer"},_s={class:"flex-1 flex flex-col gap-y-2"},gs={class:"text-sm space-x-1 flex items-center"},ys={class:"pi pi-question-circle cursor-pointer"},xs={class:"flex items-center gap-2"},bs={key:2,class:"flex items-center gap-x-2"},hs={class:"flex flex-col gap-y-2 flex-1"},ks={class:"text-sm flex items-center gap-1"},ws={class:"pi pi-question-circle cursor-pointer"},Cs={class:"flex flex-col gap-y-2 flex-1"},$s={class:"text-sm flex items-center gap-1"},Ss={class:"pi pi-question-circle cursor-pointer"},Ds={class:"flex flex-col gap-y-2"},Os={class:"flex gap-1 items-center"},Is={key:0,class:"pi pi-question-circle cursor-pointer"},Ls={key:0,class:"flex flex-col gap-y-2"},Vs={class:"flex justify-between items-center gap-x-2"},Ns={key:0,class:"text-sm text-center text-red-500 dark:text-red-300"},Fs={key:1,class:"text-sm text-center text-red-500 dark:text-red-300"},Ts={class:"mt-2"},zs={key:1,class:"space-y-2"},Us={class:"flex flex-col gap-y-2"},Ms={class:"flex items-center gap-1"},js={key:0,class:"pi pi-question-circle cursor-pointer"},As={key:0,class:"space-y-2"},Es={key:0,class:"text-sm text-center text-red-500 dark:text-red-300"},Hs={key:1,class:"text-sm text-center text-red-500 dark:text-red-300"},qs={key:3,class:"space-y-2"},Js={key:0,class:"flex flex-col gap-y-2"},Ps={class:"text-sm flex items-center gap-1"},Bs={class:"pi pi-question-circle cursor-pointer"},Rs={key:0,class:"space-y-2"},Ws={key:0,class:"text-sm text-center text-red-500 dark:text-red-300"},Ys={key:1,class:"text-sm text-center text-red-500 dark:text-red-300"},Gs={class:"mt-2"},Ks={key:1,class:"space-y-2"},Zs={key:4,class:"flex flex-col gap-y-2"},Qs={class:"flex items-center gap-3"},Xs={for:"cross-section-toggle",class:"cursor-pointer"},ea={class:"flex gap-2"},ta={for:"cross-section-toggle",class:"cursor-pointer"},la={key:0,class:"space-y-5"},sa={class:"flex gap-x-2"},aa={class:"flex-1 flex flex-col gap-2"},oa={class:"flex-1 flex flex-col gap-2"},ia={class:"text-sm text-gray-700 dark:text-gray-300 flex items-center gap-1"},na={class:"pi pi-question-circle cursor-pointer"},ra={class:"flex flex-col gap-2"},ua={class:"text-sm text-gray-700 dark:text-gray-300 flex items-center gap-1"},ca={class:"pi pi-question-circle cursor-pointer"},fa={class:"w-full"},da={class:"flex flex-col gap-2"},va={class:"mt-4"},pa={class:"space-y-2"},ma={class:"flex items-center gap-2"},_a={for:"other-section-toggle",class:"cursor-pointer"},ga={class:"pi pi-question-circle cursor-pointer"},ya={key:0,class:"mt-4"},xa={class:"flex flex-col gap-4"},ba={class:"flex justify-center gap-4"},ha={key:0,class:"flex flex-col gap-3"},ka={class:"flex flex-col gap-1 flex-1"},wa={class:"flex flex-col gap-1 flex-2"},Ca={class:"flex items-center gap-2"},$a={key:1,class:"text-center text-gray-500 dark:text-gray-400 text-xs"},Sa=at({__name:"addOrEditStrategyDrawer.tmpl",props:{drawerTitle:{},allConfigInfo:{},nameErrorMessage:{}},emits:["refreshConfigInfo"],setup(Qe,{expose:Z,emit:Ee}){const me=ot(),De=it(),P=Qe,be=Ee,ae=d(!1),B=d(!1),ee=d(!1),t=d(Lt),b=d([]),x=d([]),te=d(!1),R=d(!1),M=d(!1),q=d(!1),le=d([{label:"多空统一",value:"factorList"},{label:"多空分离",value:"longOrShort"}]),E=d([{label:"多头",value:"long"},{label:"空头",value:"short"}]),oe=d([{label:"纯多",value:"long"},{label:"纯空",value:"short"},{label:"中性",value:"center"},{label:"自定义",value:"set"}]),W=d("set"),H=d("factorList"),F=d("factorList"),J=d("factorList"),Q=d("long"),Y=d("long"),T=d("long"),se=d(null),L=d([]),ie=d([]),j=d(null),he=d([]),de=d({策略直播:[],论坛帖子:[],相关船队:[],策略说明:"",使用案例:{}}),_e=d({策略直播:[],论坛帖子:[],相关船队:[],策略说明:"",使用案例:{}}),ne=d(!1),G=d(!1),A=d("");Gt(()=>t.value.long_cap_weight,s=>{t.value.short_cap_weight=(10-10*s)/10},{immediate:!0});const Fe=async(s,e)=>{if(q.value=e||!1,await He(),W.value="set",t.value=JSON.parse(JSON.stringify(Lt)),ee.value=!1,s&&(t.value={...JSON.parse(JSON.stringify(t.value)),...JSON.parse(JSON.stringify(s||{}))},X(t.value))){const n=(v,h)=>((v==null?void 0:v.length)??0)>0||((h==null?void 0:h.length)??0)>0;H.value=n(t.value.long_factor_list,t.value.short_factor_list)?"longOrShort":"factorList",F.value=n(t.value.long_filter_list,t.value.short_filter_list)?"longOrShort":"factorList",J.value=n(t.value.long_filter_list_post,t.value.short_filter_list_post)?"longOrShort":"factorList"}if(t.value.other_factor_list&&t.value.other_factor_list.length>0?(M.value=!0,t.value.other_factor_list=t.value.other_factor_list.map(n=>(Ke(n)!=="object"&&(n[0]={[n[0]]:!0}),n))):M.value=!1,ke(),q.value===!0){let n="";n=t.value.strategy,Ve(n,Se.strategy)}ae.value=!0},He=async()=>{const s=await Mt();s.result===!0&&(j.value=s.data,L.value=[],ie.value=[],s.data!==null&&Object.keys(s.data).length>0&&(Object.keys(s.data).forEach(n=>{const v=s.data;L.value.push({key:n,label:n==="factors"?"时序因子":"截面因子",selectable:!1,children:v[n].map(h=>({key:h.name,label:h.name}))||[]})}),ie.value=JSON.parse(JSON.stringify(L.value))))},ge=()=>{let s=Array.from({length:24},(e,n)=>(n+1).toString()+"H");return s.push("1D"),s},Te=s=>{let e=ke();t.value.offset_list=Array.from({length:e},(n,v)=>v)},ke=()=>{let s=0;return t.value.hold_period?(t.value.hold_period.includes("H")&&(s=Number(t.value.hold_period.split("H")[0])),t.value.hold_period.includes("D")&&(s=Number(t.value.hold_period.split("D")[0]))):t.value.offset_list=[],b.value=Array.from({length:s},(e,n)=>({label:n.toString(),value:n})),s},qe=()=>{let s=["2D","3D","4D","5D","6D","7D","8D","9D"],e=["W","1W","2W","3W","4W","5W","6W"];return[{key:"group-day",label:"天",selectable:!1,children:s.map(n=>({key:n,label:n}))},{key:"group-week",label:"周",selectable:!1,children:[...e.map(n=>({key:n,label:n})),{key:"W53",label:"W53"}]},{key:"group-month",label:"月",selectable:!1,children:[{key:"M",label:"M"}]}]},Je=s=>{let e=N();t.value.offset_list=JSON.parse(JSON.stringify(e))},N=()=>{let s=0,e=[];if(t.value.hold_period){const n=Object.keys(t.value.hold_period)[0];n.includes("D")&&(s=Number(n.split("D")[0]),e=Array.from({length:s},(v,h)=>h)),n.includes("W")&&(n==="1W"||n==="W"?e=[0,1,2,3,4]:n==="W53"?e=[0]:(s=Number(n.split("W")[0]),e=Array.from({length:s},(v,h)=>h))),n==="M"&&(e=[-5,0])}else e=[];return x.value=e.map(n=>({label:n.toString(),value:n})),e},r=Ze(()=>{let s=["open","close-open"];for(let e=930;e<=1130;e+=5)if(e%100<60){let v=e.toString().padStart(4,"0");s.push(`${v}-${v}`)}for(let e=1305;e<=1455;e+=5)if(e%100<60){let v=e.toString().padStart(4,"0");s.push(`${v}-${v}`)}return s}),D=async({values:s})=>{var n,v,h;const e={};if((t.value.cap_weight<0||t.value.cap_weight===null)&&(e.cap_weight=[{message:"资金权重不能为空"}]),t.value.hold_period||(e.hold_period=[{message:"持仓周期不能为空"}]),X(t.value)){/^\d+[HD]$/.test(t.value.hold_period)||(e.hold_period=[{message:"请输入类似 1H、2H、24D 的格式（整数+大写H/D）"}]),t.value.short_cap_weight===1&&t.value.market!=="swap_swap"&&(e.market=[{message:"当策略为纯空时，仅支持选择“纯合约（swap_swap）”模式。"}],e.short_long_weight=[{message:"在除“纯合约（swap_swap）”以外的模式下，不允许设置为纯空。"}]);const z=/^(\d+(\.\d+)?)(,(\d+(\.\d+)?))?$/;t.value.long_select_coin_num=t.value.long_select_coin_num+"",t.value.long_select_coin_num===null||t.value.long_select_coin_num===""?e.long_select_coin_num=[{message:"多头选币数量不能为空"}]:z.test(t.value.long_select_coin_num)?t.value.long_select_coin_num.includes(",")&&((n=t.value.long_select_coin_num)==null?void 0:n.split(",").length)===2&&((v=t.value.long_select_coin_num)==null?void 0:v.split(",")[0])>((h=t.value.long_select_coin_num)==null?void 0:h.split(",")[1])&&(e.long_select_coin_num=[{message:"区间错误：起始值不能大于结束值"}]):e.long_select_coin_num=[{message:"仅支持整数（如10）、小数（如0.5）、区间（如1,5或0.1,0.2）"}],t.value.short_select_coin_num=t.value.short_select_coin_num+"",t.value.short_select_coin_num===null||t.value.short_select_coin_num===""?e.short_select_coin_num=[{message:"空头选币数量不能为空"}]:!z.test(t.value.short_select_coin_num)&&t.value.short_select_coin_num!=="long_nums"?e.short_select_coin_num=[{message:"仅支持整数（如10）、小数（如0.5）、区间（如1,5或0.1,0.2）、long_nums"}]:t.value.short_select_coin_num.includes(",")&&t.value.short_select_coin_num.split(",").length===2&&t.value.short_select_coin_num.split(",")[0]>t.value.short_select_coin_num.split(",")[1]&&(e.short_select_coin_num=[{message:"区间错误：起始值不能大于结束值"}])}return(t.value.offset_list===null||t.value.offset_list.length===0)&&(e.offset_list=[{message:"offset不能为空"}]),{values:s,errors:e}},re=s=>{X(t.value)&&(s==="center"?t.value.long_cap_weight=.5:s==="long"?t.value.long_cap_weight=1:t.value.long_cap_weight=0)},ue=()=>{var s;(s=se.value)==null||s.submit()},ze=s=>{s===!0&&!t.value.timing?t.value.timing={name:"",limit:0,factor_list:[],params:null}:t.value.timing=null},Pe=s=>{s===!1&&(t.value.cross_sections=[])},Oe=s=>{s===!1&&(t.value.other_factor_list=[])},ye=s=>{!s||s.length===0||s.forEach(e=>{Ke(e[0])==="object"&&(e[0]=Object.keys(e[0])[0])})},Ie=()=>{A.value="",t.value.other_factor_list&&t.value.other_factor_list.forEach((s,e)=>{if(!s[0]){A.value=`第${e+1}行，请选择因子`;return}})},Be=async({valid:s})=>{var e,n,v,h,V,z,ce,ve,Ce;if(P.nameErrorMessage){me.add({severity:"error",summary:`新增的配置，${P.nameErrorMessage}`,life:3e3});return}if(Ie(),!A.value&&s){X(t.value)&&(t.value.long_select_coin_num=Vt(t.value.long_select_coin_num),t.value.short_select_coin_num=Vt(t.value.short_select_coin_num,"long_nums"),H.value==="factorList"?(t.value.long_factor_list=[],t.value.short_factor_list=[]):t.value.factor_list=[],F.value==="factorList"?(t.value.long_filter_list=[],t.value.short_filter_list=[]):t.value.filter_list=[],J.value==="factorList"?(t.value.long_filter_list_post=[],t.value.short_filter_list_post=[]):t.value.filter_list_post=[],[(e=t.value)==null?void 0:e.long_factor_list,(n=t.value)==null?void 0:n.short_factor_list,(v=t.value)==null?void 0:v.long_filter_list,(h=t.value)==null?void 0:h.short_filter_list,(V=t.value)==null?void 0:V.filter_list_post,(z=t.value)==null?void 0:z.long_filter_list_post,(ce=t.value)==null?void 0:ce.short_filter_list_post].forEach(ye)),[(ve=t.value)==null?void 0:ve.factor_list,(Ce=t.value)==null?void 0:Ce.filter_list].forEach(ye),t.value.strategy=t.value.strategy||"未命名策略"+st(new Date).format("YYYY-MM-DD_THH:mm:ss");let pe={},xe=JSON.parse(JSON.stringify(P.allConfigInfo));if(P.drawerTitle==="编辑策略"){let O=xe.strategy_list.map(f=>f.id===t.value.id?Ke(t.value.hold_period)==="object"?{...JSON.parse(JSON.stringify(t.value)),hold_period:Object.keys(t.value.hold_period)[0]}:JSON.parse(JSON.stringify(t.value)):f);O=O.map(f=>(delete f.id,f!=null&&f.other_factor_list&&(f==null?void 0:f.other_factor_list.length)>0&&ye(f.other_factor_list),f)),pe={...xe,strategy_list:O}}else{let O={};Ke(t.value.hold_period)==="object"?O={...JSON.parse(JSON.stringify(t.value)),hold_period:Object.keys(t.value.hold_period)[0]}:O=JSON.parse(JSON.stringify(t.value));let f=[...xe.strategy_list,O];f=f.map($=>(delete $.id,$!=null&&$.other_factor_list&&($==null?void 0:$.other_factor_list.length)>0&&ye($.other_factor_list),$)),pe={...xe,strategy_list:f}}ee.value=!0;const Ne=await jt(pe);ee.value=!1,Ne.result===!0&&(be("refreshConfigInfo"),ae.value=!1)}},Re=s=>{s==="spot_spot"&&C==="coin"&&X(t.value)&&(t.value.long_cap_weight=1,t.value.short_cap_weight=0,t.value.short_select_coin_num=0,H.value="factorList")},Le=()=>{De.require({group:"close",message:"当前的修改还未保存，确定要关闭吗？",header:"确认关闭",icon:"pi pi-exclamation-triangle text-yellow-500",rejectProps:{label:"取消",outlined:!0},acceptProps:{label:"确定",severity:"secondary"},accept:()=>{ae.value=!1},reject:()=>{}})},Ve=async(s,e)=>{e===Se.strategy?(ne.value=!0,de.value={策略直播:[],论坛帖子:[],相关船队:[],策略说明:"",使用案例:{}}):(G.value=!0,_e.value={策略直播:[],论坛帖子:[],相关船队:[],策略说明:"",使用案例:{}});const n=await lt(encodeURIComponent(s),e);e===Se.strategy?(ne.value=!1,n.result===!0&&n.data&&(de.value=n.data)):(G.value=!1,n.result===!0&&n.data&&(_e.value=n.data))},Ue=async s=>{await Ve(s,Se.timing)},we=Ze(()=>{const s=e=>!e||!Array.isArray(e)||e.length===0;if(X(t.value)){const{filter_list:e,long_filter_list:n,short_filter_list:v}=t.value;return s(e)&&s(n)&&s(v)}return s(t.value.filter_list)}),w=()=>{Array.isArray(t.value.other_factor_list)||(t.value.other_factor_list=[]);const s=e=>{if(!Array.isArray(t.value.other_factor_list))return;const n=typeof e[0]=="object"?Object.keys(e[0])[0]:e[0];t.value.other_factor_list.push([{[n]:!0},e[1],"pct:>=-999"])};X(t.value)&&(Array.isArray(t.value.filter_list)&&t.value.filter_list.forEach(s),Array.isArray(t.value.long_filter_list)&&t.value.long_filter_list.forEach(s),Array.isArray(t.value.short_filter_list)&&t.value.short_filter_list.forEach(s))};return Z({openDrawer:Fe}),(s,e)=>{const n=ut,v=Vl,h=rt,V=Wt,z=ml,ce=Bt,ve=_l,Ce=Nl,pe=Et,xe=gl,Ne=Yt,O=zl,f=Tl,$=Fl,U=Ul,Me=Ll,Ye=pl,Ge=qt,K=nt;return a(),c(S,null,[o(Ye,{visible:ae.value,"onUpdate:visible":e[40]||(e[40]=I=>ae.value=I),header:s.drawerTitle,dismissable:!1,position:B.value?"full":"right",class:"w-[50vw]",pt:{content:{class:"flex flex-col pb-20"},header:{class:"py-3"}}},{closebutton:u(()=>[l("div",Hl,[k(o(n,{icon:B.value?"pi pi-window-minimize":"pi pi-window-maximize",variant:"text",severity:"secondary",onClick:e[0]||(e[0]=I=>B.value=!B.value)},null,8,["icon"]),[[K,B.value?"退出全屏":"全屏",void 0,{left:!0}]]),o(n,{label:"保存",size:"small",onClick:ue,loading:ee.value},null,8,["loading"]),o(n,{icon:"pi pi-times",variant:"text",severity:"secondary",rounded:"",onClick:Le})])]),default:u(()=>[o(Me,{ref_key:"refForm",ref:se,resolver:D,onSubmit:Be,class:"flex-1 flex flex-col space-y-4"},{default:u(I=>{var ct,ft,dt,vt,pt,mt,_t,gt,yt,xt,bt,ht,kt,wt,Ct,$t,St,Dt,Ot;return[l("div",ql,[q.value?(a(),y(v,{key:0,header:`「${m(C)==="stock"?t.value.name:t.value.strategy}」策略教程`,toggleable:"",class:"text-md bg-primary-50 dark:bg-gray-700",pt:{header:{class:"text-primary-600 dark:text-primary-500 px-2 py-0"}}},{default:u(()=>[o(We,{isLoading:ne.value,teachInfo:de.value},null,8,["isLoading","teachInfo"])]),_:1},8,["header"])):p("",!0),l("div",Jl,[l("div",{class:tt(["flex flex-col gap-y-2",B.value?"flex-1":"flex-4"])},[e[41]||(e[41]=l("label",{class:"text-sm space-x-1 flex items-center"},[l("span",{class:"text-red-500"},"*"),l("span",{class:"font-bold"},"策略名称")],-1)),m(C)==="coin"&&m(X)(t.value)?(a(),c(S,{key:0},[o(h,{modelValue:t.value.strategy,"onUpdate:modelValue":e[1]||(e[1]=i=>t.value.strategy=i),modelModifiers:{trim:!0},name:"strategy",type:"text",placeholder:"请填写策略名称",class:"w-full",size:"small",disabled:q.value},null,8,["modelValue","disabled"]),(ct=I.strategy)!=null&&ct.invalid?(a(),y(V,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>{var i;return[g(_((i=I.strategy.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)],64)):m(C)==="stock"&&m(je)(t.value)?(a(),c(S,{key:1},[o(h,{modelValue:t.value.name,"onUpdate:modelValue":e[2]||(e[2]=i=>t.value.name=i),modelModifiers:{trim:!0},name:"name",type:"text",placeholder:"请填写策略名称",class:"w-full",size:"small",disabled:q.value},null,8,["modelValue","disabled"]),(ft=I.name)!=null&&ft.invalid?(a(),y(V,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>{var i;return[g(_((i=I.name.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)],64)):p("",!0)],2),l("div",Pl,[l("label",Bl,[e[42]||(e[42]=l("span",{class:"text-red-500"},"*",-1)),e[43]||(e[43]=l("span",{class:"font-bold"},"资金权重",-1)),k(l("i",Rl,null,512),[[K,{value:"资金占比，多策略组合时使用，会做归一化计算。如有两个策略，每个策略的cap_weight都设置为1，那么每个子策略的资金占比为 1/(1+1) = 0.5，也就是每个子策略资金占比50%。",autoHide:!1,escape:!1},void 0,{bottom:!0}]])]),o(z,{modelValue:t.value.cap_weight,"onUpdate:modelValue":e[3]||(e[3]=i=>t.value.cap_weight=i),name:"cap_weight",minFractionDigits:0,maxFractionDigits:3,step:.1,min:0,max:1,mode:"decimal",showButtons:"",size:"small"},null,8,["modelValue"]),(dt=I.cap_weight)!=null&&dt.invalid?(a(),y(V,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>{var i;return[g(_((i=I.cap_weight.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)])]),l("div",Wl,[l("div",Yl,[l("label",Gl,[e[44]||(e[44]=l("span",{class:"text-red-500"},"*",-1)),e[45]||(e[45]=l("span",{class:"font-bold"},"持仓周期",-1)),k(l("i",Kl,null,512),[[K,{value:m(C)==="coin"?"选币持仓的时间，H代表小时，持仓几个小时，有1H到24H一共24种选择；D代表日，1D持仓一天。":"选股交易的持股周期，D表示持股几天，如3D就是持股3天。W表示持股一周，M表示持股一个月。具体参数参照股票周期预运算表的数据文件。",autoHide:!1,escape:!1},void 0,{bottom:!0}]])]),m(C)==="coin"?(a(),y(ce,{key:0,modelValue:t.value.hold_period,"onUpdate:modelValue":e[4]||(e[4]=i=>t.value.hold_period=i),name:"hold_period",editable:"",options:ge(),placeholder:"请选择/输入持仓周期，输入如7D",size:"small",onValueChange:Te},null,8,["modelValue","options"])):(a(),y(ve,{key:1,modelValue:t.value.hold_period,"onUpdate:modelValue":e[5]||(e[5]=i=>t.value.hold_period=i),name:"hold_period",filter:"",filterMode:"lenient",options:qe(),placeholder:"请选择持仓周期",size:"small",class:"w-full",onValueChange:Je},null,8,["modelValue","options"])),(vt=I.hold_period)!=null&&vt.invalid?(a(),y(V,{key:2,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>{var i;return[g(_((i=I.hold_period.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)]),l("div",Zl,[l("label",Ql,[e[46]||(e[46]=l("span",{class:"text-red-500"},"*",-1)),e[47]||(e[47]=l("span",{class:"font-bold"},"offset_list",-1)),k(l("i",Xl,null,512),[[K,{value:m(C)==="coin"?"选择持仓的offset，具体原理请参考：<a href='https://bbs.quantclass.cn/thread/46812' target='_blank' class='text-primary-500 hover:underline'>【小白入门】持仓周期，offset和分钟偏移——入门基础知识系列 - 量化小论坛</a>":"与持股周期配合的具体offset，具体原理请参考：<a href='https://bbs.quantclass.cn/thread/46812' target='_blank' class='text-primary-500 hover:underline'>【小白入门】持仓周期，offset和分钟偏移——入门基础知识系列 - 量化小论坛</a>",autoHide:!1,escape:!1},void 0,{bottom:!0}]])]),m(C)==="coin"?(a(),y(Ce,{key:0,modelValue:t.value.offset_list,"onUpdate:modelValue":e[6]||(e[6]=i=>t.value.offset_list=i),name:"offset_list",options:b.value,optionLabel:"label",optionValue:"value",placeholder:"请选择offset",minSelectedLabels:1,class:"w-full",size:"small",filter:"",maxSelectedLabels:5,"selected-items-label":t.value.offset_list.length===b.value.length?"全offset覆盖":`${t.value.offset_list.length}个offset`,emptyFilterMessage:"无匹配结果",emptyMessage:"暂无数据"},null,8,["modelValue","options","selected-items-label"])):(a(),y(Ce,{key:1,modelValue:t.value.offset_list,"onUpdate:modelValue":e[7]||(e[7]=i=>t.value.offset_list=i),name:"offset_list",options:x.value,optionLabel:"label",optionValue:"value",placeholder:"请选择offset",minSelectedLabels:1,class:"w-full",size:"small",filter:"",maxSelectedLabels:5,"selected-items-label":t.value.offset_list.length===x.value.length?"全offset覆盖":`${t.value.offset_list.length}个offset`,emptyFilterMessage:"无匹配结果",emptyMessage:"暂无数据"},null,8,["modelValue","options","selected-items-label"])),(pt=I.offset_list)!=null&&pt.invalid?(a(),y(V,{key:2,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>{var i;return[g(_((i=I.offset_list.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)])]),m(C)==="coin"&&m(X)(t.value)?(a(),c(S,{key:1},[l("div",es,[l("label",ts,[e[48]||(e[48]=l("span",{class:"text-red-500"},"*",-1)),e[49]||(e[49]=l("span",{class:"font-bold"},"选币范围(现货/合约)",-1)),k(l("i",ls,null,512),[[K,{value:m(Tt),autoHide:!1,escape:!1,class:"min-w-80"},void 0,{bottom:!0}]])]),o(ce,{modelValue:t.value.market,"onUpdate:modelValue":e[8]||(e[8]=i=>t.value.market=i),options:m(zt),optionLabel:"label",optionValue:"value",placeholder:"请选择选币范围(现货/合约)",class:"w-full",size:"small",name:"market",onValueChange:Re},null,8,["modelValue","options"]),l("span",ss,_(t.value.market)+": "+_(m(Ut)[t.value.market]),1),(mt=I.market)!=null&&mt.invalid?(a(),y(V,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>{var i;return[g(_((i=I.market.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)]),l("div",as,[l("label",os,[e[50]||(e[50]=l("span",{class:"text-red-500"},"*",-1)),e[51]||(e[51]=l("span",{class:"font-bold"},"多头权重/空头权重",-1)),k(l("i",is,null,512),[[K,{value:`多头权重：多头在子策略的仓位占比，如1表示纯多策略
空头权重：空头在子策略的仓位占比，如1表示纯空策略`,autoHide:!1,escape:!1,class:"min-w-90"}]]),t.value.market==="spot_spot"?(a(),c("span",ns," ( spot_spot模式，默认多头权重为1，空头权重为0,不可变更! ) ")):p("",!0)]),l("div",rs,[o(pe,{options:oe.value,modelValue:W.value,"onUpdate:modelValue":e[9]||(e[9]=i=>W.value=i),"option-label":"label","option-value":"value",size:"small",onValueChange:re,disabled:t.value.market==="spot_spot"},null,8,["options","modelValue","disabled"]),l("div",us,[l("span",cs,"多头权重"+_(t.value.long_cap_weight),1),o(xe,{modelValue:t.value.long_cap_weight,"onUpdate:modelValue":e[10]||(e[10]=i=>t.value.long_cap_weight=i),step:.1,max:1,class:"flex-1",disabled:t.value.market==="spot_spot"||W.value!=="set",name:"short_long_weight"},null,8,["modelValue","disabled"]),l("span",fs,"空头权重"+_(t.value.short_cap_weight),1)])]),(_t=I.short_long_weight)!=null&&_t.invalid?(a(),y(V,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>{var i;return[g(_((i=I.short_long_weight.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)]),l("div",ds,[l("div",vs,[l("label",ps,[e[52]||(e[52]=l("span",{class:"text-red-500"},"*",-1)),e[53]||(e[53]=l("span",{class:"font-bold"},"多头选币数量",-1)),k(l("i",ms,null,512),[[K,{value:"支持整数（如10）、小数（如0.5）、区间（如1,5）区间起始值和结束值用英文逗号隔开",autoHide:!1},void 0,{bottom:!0}]])]),o(h,{modelValue:t.value.long_select_coin_num,"onUpdate:modelValue":e[11]||(e[11]=i=>t.value.long_select_coin_num=i),modelModifiers:{trim:!0},name:"long_select_coin_num",placeholder:"支持整数（如10）、小数（如0.5）、区间（如1,5）区间起始值和结束值用英文逗号隔开",class:"w-full",size:"small"},null,8,["modelValue"]),(gt=I.long_select_coin_num)!=null&&gt.invalid?(a(),y(V,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>{var i;return[g(_((i=I.long_select_coin_num.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)]),l("div",_s,[l("label",gs,[e[54]||(e[54]=l("span",{class:"text-red-500"},"*",-1)),e[55]||(e[55]=l("span",{class:"font-bold"},"空头选币数量",-1)),k(l("i",ys,null,512),[[K,{value:"支持输入整数， 小数，long_nums(和多头选币数量一致),区间（如1,5）区间起始值和结束值用英文逗号隔开",autoHide:!1},void 0,{bottom:!0}]])]),l("div",xs,[o(n,{variant:"outlined",onClick:e[12]||(e[12]=i=>t.value.short_select_coin_num="long_nums"),class:"flex-shink-0 text-xs",severity:"secondary",disabled:t.value.market==="spot_spot"},{default:u(()=>e[56]||(e[56]=[g("和多头一致")])),_:1,__:[56]},8,["disabled"]),o(h,{modelValue:t.value.short_select_coin_num,"onUpdate:modelValue":e[13]||(e[13]=i=>t.value.short_select_coin_num=i),modelModifiers:{trim:!0},name:"short_select_coin_num",placeholder:"支持输入整数， 小数，long_nums(和多头选币数量一致),区间（如1,5）区间起始值和结束值用英文逗号隔开",size:"small",class:"flex-1",disabled:t.value.market==="spot_spot"},null,8,["modelValue","disabled"])]),(yt=I.short_select_coin_num)!=null&&yt.invalid?(a(),y(V,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>{var i;return[g(_((i=I.short_select_coin_num.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)])])],64)):m(C)==="stock"&&m(je)(t.value)?(a(),c("div",bs,[l("div",hs,[l("label",ks,[e[57]||(e[57]=l("span",{class:"text-red-500"},"*",-1)),e[58]||(e[58]=l("span",{class:"font-bold"},"选股数量",-1)),k(l("i",ws,null,512),[[K,{value:"选股数量，可以是整数，如10就是选股10只。也可以是小数，如0.1就是选全市场10%的股票，约500+只。",autoHide:!1,escape:!1},void 0,{bottom:!0}]])]),o(z,{modelValue:t.value.select_num,"onUpdate:modelValue":e[14]||(e[14]=i=>t.value.select_num=i),name:"select_num",min:0,minFractionDigits:0,maxFractionDigits:3,mode:"decimal",showButtons:"",class:"w-full",placeholder:"请输入选股数量",size:"small"},null,8,["modelValue"]),(xt=I.select_num)!=null&&xt.invalid?(a(),y(V,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>{var i;return[g(_((i=I.select_num.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)]),l("div",Cs,[l("label",$s,[e[59]||(e[59]=l("span",{class:"text-red-500"},"*",-1)),e[60]||(e[60]=l("span",{class:"font-bold"},"换仓时间",-1)),k(l("i",Ss,null,512),[[K,{value:"换仓时机，根据持仓周期和offset交易时，在股票开始时间具体什么时刻卖出和买入。<br/>隔日换仓：'close-open'：offset结束日收盘前卖出，offset开始日开盘后买入；<br/>开盘日内换仓：'open'：offset当天实现换仓，开盘后先卖出再买入；<br/>指定时间换仓：按照5分钟为间隔指定交易日内换仓时间，如'0955-0955'是上午9:55先卖出，再买入。",autoHide:!1,escape:!1,class:"min-w-85"},void 0,{bottom:!0}]])]),o(ce,{modelValue:t.value.rebalance_time,"onUpdate:modelValue":e[15]||(e[15]=i=>t.value.rebalance_time=i),name:"rebalance_time",filter:"",options:r.value,size:"small",class:"w-full"},null,8,["modelValue","options"])])])):p("",!0),o(Ne,{align:"center",type:"solid",class:"mb-0"},{default:u(()=>e[61]||(e[61]=[l("b",{class:"text-primary-500"},"因子配置",-1)])),_:1,__:[61]}),l("div",Ds,[l("label",Os,[e[62]||(e[62]=l("span",{class:"font-bold"},"因子配置",-1)),m(C)==="coin"?k((a(),c("i",Is,null,512)),[[K,{value:`多空统一：多头和空头因子设置相同；
多空分离：多头和空头因子设置不相同，可以分开设置；`,autoHide:!1,class:"min-w-85"}]]):p("",!0)]),m(C)==="coin"&&m(X)(t.value)?(a(),c(S,{key:0},[o($,{value:H.value,"onUpdate:value":e[16]||(e[16]=i=>H.value=i),class:"w-full"},{default:u(()=>[o(f,{class:"px-2 py-1"},{default:u(()=>[(a(!0),c(S,null,$e(le.value,i=>(a(),y(O,{key:i.label,value:i.value,pt:{root:"px-4 py-2"},disabled:t.value.market==="spot_spot"},{default:u(()=>[g(_(i.label),1)]),_:2},1032,["value","disabled"]))),128))]),_:1})]),_:1},8,["value"]),H.value==="longOrShort"?(a(),c("div",Ls,[l("div",Vs,[o(pe,{options:E.value,modelValue:Q.value,"onUpdate:modelValue":e[17]||(e[17]=i=>Q.value=i),"option-label":"label","option-value":"value",size:"small"},null,8,["options","modelValue"])]),t.value.long_cap_weight===0&&Q.value==="long"?(a(),c("div",Ns," 多头权重为0，不可配置因子信息 ")):p("",!0),t.value.short_cap_weight===0&&Q.value==="short"?(a(),c("div",Fs," 空头权重为0，不可配置因子信息 ")):p("",!0)])):p("",!0)],64)):m(C)==="stock"&&m(je)(t.value)?(a(),c(S,{key:1},[],64)):p("",!0),l("div",Ts,[H.value==="factorList"?(a(),y(fe,{key:0,propkey:"1",factorList:t.value.factor_list||[],title:"",factorSelect:"因子",factorNameOpetions:L.value,allFactorInfo:j.value,onSaveData:e[18]||(e[18]=i=>t.value.factor_list=i),isDemoStrategy:q.value},null,8,["factorList","factorNameOpetions","allFactorInfo","isDemoStrategy"])):m(C)==="coin"?(a(),c("div",zs,[m(X)(t.value)?(a(),c(S,{key:0},[Q.value==="long"?(a(),y(fe,{key:0,propkey:"2",factorList:((bt=t.value)==null?void 0:bt.long_factor_list)||[],title:"多头选币",factorSelect:"因子",factorNameOpetions:L.value,allFactorInfo:j.value,onSaveData:e[19]||(e[19]=i=>t.value.long_factor_list=i),disabled:t.value.long_cap_weight===0},null,8,["factorList","factorNameOpetions","allFactorInfo","disabled"])):(a(),y(fe,{key:1,propkey:"3",factorList:((ht=t.value)==null?void 0:ht.short_factor_list)||[],title:"空头选币",factorSelect:"因子",factorNameOpetions:L.value,allFactorInfo:j.value,onSaveData:e[20]||(e[20]=i=>t.value.short_factor_list=i),disabled:t.value.short_cap_weight===0},null,8,["factorList","factorNameOpetions","allFactorInfo","disabled"]))],64)):p("",!0)])):p("",!0)])]),l("div",Us,[l("label",Ms,[e[63]||(e[63]=l("span",{class:"font-bold"},"前置过滤因子配置",-1)),m(C)==="coin"?k((a(),c("i",js,null,512)),[[K,{value:`多空统一：多头和空头因子设置相同；
多空分离：多头和空头因子设置不相同，可以分开设置；`,autoHide:!1,class:"min-w-85"}]]):p("",!0)]),m(C)==="coin"&&m(X)(t.value)?(a(),c(S,{key:0},[o($,{value:F.value,"onUpdate:value":e[21]||(e[21]=i=>F.value=i),class:"w-full"},{default:u(()=>[o(f,{class:"px-2 py-1"},{default:u(()=>[(a(!0),c(S,null,$e(le.value,i=>(a(),y(O,{key:i.label,value:i.value,pt:{root:"px-4 py-2"},disabled:t.value.market==="spot_spot"},{default:u(()=>[g(_(i.label),1)]),_:2},1032,["value","disabled"]))),128))]),_:1})]),_:1},8,["value"]),F.value==="longOrShort"?(a(),c("div",As,[o(pe,{options:E.value,modelValue:Y.value,"onUpdate:modelValue":e[22]||(e[22]=i=>Y.value=i),"option-label":"label","option-value":"value",size:"small"},null,8,["options","modelValue"]),t.value.long_cap_weight===0&&Y.value==="long"?(a(),c("div",Es," 多头权重为0，不可配置因子信息 ")):p("",!0),t.value.short_cap_weight===0&&Y.value==="short"?(a(),c("div",Hs," 空头权重为0，不可配置因子信息 ")):p("",!0)])):p("",!0)],64)):m(C)==="stock"&&m(je)(t.value)?(a(),c(S,{key:1},[],64)):p("",!0),F.value==="factorList"?(a(),y(fe,{key:2,propkey:"4",factorList:t.value.filter_list||[],title:"前置过滤",factorSelect:"前置过滤因子",factorNameOpetions:L.value,allFactorInfo:j.value,onSaveData:e[23]||(e[23]=i=>t.value.filter_list=i),isDemoStrategy:q.value},null,8,["factorList","factorNameOpetions","allFactorInfo","isDemoStrategy"])):m(C)==="coin"?(a(),c("div",qs,[m(X)(t.value)?(a(),c(S,{key:0},[Y.value==="long"?(a(),y(fe,{key:0,propkey:"5",factorList:((kt=t.value)==null?void 0:kt.long_filter_list)||[],title:"多头前置过滤",factorSelect:"前置过滤因子",factorNameOpetions:L.value,allFactorInfo:j.value,onSaveData:e[24]||(e[24]=i=>t.value.long_filter_list=i),disabled:t.value.long_cap_weight===0},null,8,["factorList","factorNameOpetions","allFactorInfo","disabled"])):(a(),y(fe,{key:1,propkey:"6",factorList:((wt=t.value)==null?void 0:wt.short_filter_list)||[],title:"空头前置过滤",factorSelect:"前置过滤因子",factorNameOpetions:L.value,allFactorInfo:j.value,onSaveData:e[25]||(e[25]=i=>t.value.short_filter_list=i),disabled:t.value.short_cap_weight===0},null,8,["factorList","factorNameOpetions","allFactorInfo","disabled"]))],64)):p("",!0)])):p("",!0)]),m(C)==="coin"?(a(),c(S,{key:3},[m(X)(t.value)?(a(),c("div",Js,[l("label",Ps,[e[64]||(e[64]=l("span",{class:"font-bold"},"后置过滤因子配置",-1)),k(l("i",Bs,null,512),[[K,{value:`多空统一：多头和空头因子设置相同；
多空分离：多头和空头因子设置不相同，可以分开设置；`,autoHide:!1,class:"min-w-85"}]])]),o($,{value:J.value,"onUpdate:value":e[26]||(e[26]=i=>J.value=i),class:"w-full"},{default:u(()=>[o(f,{class:"px-2 py-1"},{default:u(()=>[(a(!0),c(S,null,$e(le.value,i=>(a(),y(O,{key:i.label,value:i.value,pt:{root:"px-4 py-2"},disabled:t.value.market==="spot_spot"},{default:u(()=>[g(_(i.label),1)]),_:2},1032,["value","disabled"]))),128))]),_:1})]),_:1},8,["value"]),J.value==="longOrShort"?(a(),c("div",Rs,[o(pe,{options:E.value,modelValue:T.value,"onUpdate:modelValue":e[27]||(e[27]=i=>T.value=i),"option-label":"label","option-value":"value",size:"small"},null,8,["options","modelValue"]),t.value.long_cap_weight===0&&T.value==="long"?(a(),c("div",Ws," 多头权重为0，不可配置因子信息 ")):p("",!0),t.value.short_cap_weight===0&&T.value==="short"?(a(),c("div",Ys," 空头权重为0，不可配置因子信息 ")):p("",!0)])):p("",!0),l("div",Gs,[J.value==="factorList"?(a(),y(fe,{key:0,propkey:"7",factorList:t.value.filter_list_post||[],title:"后置过滤",factorSelect:"后置过滤因子",factorNameOpetions:L.value,allFactorInfo:j.value,onSaveData:e[28]||(e[28]=i=>t.value.filter_list_post=i)},null,8,["factorList","factorNameOpetions","allFactorInfo"])):(a(),c("div",Ks,[T.value==="long"?(a(),y(fe,{key:0,propkey:"8",factorList:((Ct=t.value)==null?void 0:Ct.long_filter_list_post)||[],title:"多头后置过滤",factorSelect:"后置过滤因子",factorNameOpetions:L.value,allFactorInfo:j.value,onSaveData:e[29]||(e[29]=i=>t.value.long_filter_list_post=i),disabled:t.value.long_cap_weight===0},null,8,["factorList","factorNameOpetions","allFactorInfo","disabled"])):(a(),y(fe,{key:1,propkey:"9",factorList:(($t=t.value)==null?void 0:$t.short_filter_list_post)||[],title:"空头后置过滤",factorSelect:"后置过滤因子",factorNameOpetions:L.value,allFactorInfo:j.value,onSaveData:e[30]||(e[30]=i=>t.value.short_filter_list_post=i),disabled:t.value.short_cap_weight===0},null,8,["factorList","factorNameOpetions","allFactorInfo","disabled"]))]))])])):p("",!0)],64)):m(C)==="stock"&&m(je)(t.value)?(a(),c("div",Zs,[e[65]||(e[65]=l("label",{class:"flex items-center gap-1"},[l("span",{class:"font-bold"},"截面因子配置"),l("span",{class:"text-primary-500 text-sm"},"(该功能尚未直播，请先保持默认配置)")],-1)),l("div",Qs,[o(U,{modelValue:te.value,"onUpdate:modelValue":e[31]||(e[31]=i=>te.value=i),inputId:"cross-section-toggle","aria-label":"截面因子启用开关",onValueChange:Pe},null,8,["modelValue"]),l("label",Xs,_(te.value?"已启用截面因子":"未启用截面因子"),1)]),k(o(Ht,{factorList:t.value.cross_sections,factorNameOpetions:ie.value,allFactorInfo:j.value,isEdit:!0,onSaveData:e[32]||(e[32]=i=>t.value.cross_sections=i),isDemoStrategy:q.value},null,8,["factorList","factorNameOpetions","allFactorInfo","isDemoStrategy"]),[[Kt,te.value===!0]])])):p("",!0),m(C)==="stock"?(a(),c(S,{key:5},[o(Ne,{align:"center",type:"solid",class:"mb-0"},{default:u(()=>e[66]||(e[66]=[l("b",{class:"text-primary-500"},"择时信号配置",-1)])),_:1,__:[66]}),l("div",ea,[o(U,{modelValue:R.value,"onUpdate:modelValue":e[33]||(e[33]=i=>R.value=i),inputId:"cross-section-toggle","aria-label":"择时信号启用开关",onValueChange:ze},null,8,["modelValue"]),l("label",ta,_(R.value?"已启用择时信号":"未启用择时信号"),1)]),m(je)(t.value)&&t.value.timing&&R.value?(a(),c("div",la,[m(C)==="stock"&&t.value.timing.name?(a(),y(v,{key:0,header:`「${t.value.timing.name}」策略教程`,toggleable:"",class:"text-md bg-primary-50 dark:bg-gray-700",pt:{header:{class:"text-primary-600 dark:text-primary-500 px-2 py-0"}}},{default:u(()=>[o(We,{isLoading:G.value,teachInfo:_e.value},null,8,["isLoading","teachInfo"])]),_:1},8,["header"])):p("",!0),l("div",sa,[l("div",aa,[e[67]||(e[67]=l("label",{class:"text-sm text-gray-700 dark:text-gray-300 flex items-center gap-1"},[l("span",{class:"text-red-500"},"*"),l("span",null,"择时策略名称")],-1)),o(ce,{modelValue:t.value.timing.name,"onUpdate:modelValue":e[34]||(e[34]=i=>t.value.timing.name=i),name:"timingName",filter:"",options:he.value,size:"small",class:"w-full",onValueChange:Ue},null,8,["modelValue","options"]),(St=I.timingName)!=null&&St.invalid?(a(),y(V,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>{var i;return[g(_((i=I.timingName.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)]),l("div",oa,[l("label",ia,[e[68]||(e[68]=g(" 择时阈值（limit） ")),k(l("i",na,null,512),[[K,{value:"择时信号计算的选股范围，有三种形式：0，小数和整数。<br/>0，代表全市场（选股策略过滤过的全市场）。<br/>小数，如0.2代表全市场的20%。<br/>整数，如200代表200只股票。<br/>",autoHide:!1,escape:!1,class:"min-w-85"}]])]),o(z,{modelValue:t.value.timing.limit,"onUpdate:modelValue":e[35]||(e[35]=i=>t.value.timing.limit=i),placeholder:"例如：100 或 0.5",min:0,minFractionDigits:0,maxFractionDigits:3,class:"w-full",mode:"decimal",size:"small"},null,8,["modelValue"])])]),l("div",ra,[l("label",ua,[e[69]||(e[69]=l("span",{class:"text-red-500"},"*",-1)),e[70]||(e[70]=g(" 择时参数 ")),k(l("i",ca,null,512),[[K,{value:"择时规则参数，目前14个定风波因子有固定阈值，时间周期，技术指标等几种参数类型。",autoHide:!1,escape:!1,class:"min-w-85"}]])]),l("div",fa,[o(z,{class:"hidden",name:"timingParams"}),o(Nt,{parameData:t.value.timing.params,"onUpdate:parameData":e[36]||(e[36]=i=>t.value.timing.params=i)},null,8,["parameData"]),(Dt=I.timingParams)!=null&&Dt.invalid?(a(),y(V,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>{var i;return[g(_((i=I.timingParams.error)==null?void 0:i.message),1)]}),_:2},1024)):p("",!0)])]),l("div",da,[e[71]||(e[71]=l("label",{class:"text-sm text-gray-700 dark:text-gray-300 flex items-center gap-1"}," 择时因子 ",-1)),o(fe,{propkey:new Date().getTime(),factorList:t.value.timing.factor_list||[],title:"择时",factorSelect:"因子",factorNameOpetions:L.value,allFactorInfo:j.value,onSaveData:e[37]||(e[37]=i=>t.value.timing.factor_list=i),isDemoStrategy:q.value},null,8,["propkey","factorList","factorNameOpetions","allFactorInfo","isDemoStrategy"])])])):p("",!0)],64)):p("",!0),l("div",va,[o(Ne,{align:"center",type:"solid",class:"mb-0"},{default:u(()=>e[72]||(e[72]=[l("b",{class:"text-primary-500"},"分域配置",-1)])),_:1,__:[72]}),l("div",pa,[l("div",ma,[o(U,{modelValue:M.value,"onUpdate:modelValue":e[38]||(e[38]=i=>M.value=i),inputId:"other-section-toggle","aria-label":"分域配置启用开关",onValueChange:Oe},null,8,["modelValue"]),l("label",_a,_(M.value?"已启用分域配置":"未启用分域配置"),1),k(l("i",ga,null,512),[[K,{value:`${m(C)==="coin"?m(Zt):m(Qt)}`,autoHide:!1,escape:!1,class:"min-w-150"}]])]),e[73]||(e[73]=l("span",{class:"text-sm text-primary-500"},"这是高级功能，建议在充分了解后再进行配置",-1))]),M.value?(a(),c("div",ya,[l("div",xa,[l("div",ba,[o(n,{icon:"pi pi-plus",label:"添加新的分域",severity:"secondary",size:"small",onClick:e[39]||(e[39]=()=>{t.value.other_factor_list||(t.value.other_factor_list=[]),t.value.other_factor_list.push(["",1,"pct:>=-999"])})}),o(n,{icon:"pi pi-plus",label:"添加过滤因子作为分域配置",severity:"secondary",size:"small",disabled:we.value,onClick:w},null,8,["disabled"])]),t.value.other_factor_list&&((Ot=t.value.other_factor_list)==null?void 0:Ot.length)>0?(a(),c("div",ha,[(a(!0),c(S,null,$e(t.value.other_factor_list,(i,It)=>(a(),c("div",{key:It,class:"flex gap-2 p-3 border border-gray-200 dark:border-gray-700 rounded"},[l("div",ka,[e[74]||(e[74]=l("span",{class:"text-xs text-gray-600 dark:text-gray-300"},"因子",-1)),o(ve,{modelValue:i[0],"onUpdate:modelValue":Xe=>i[0]=Xe,filter:"",filterMode:"lenient",options:m(C)==="coin"?ie.value:L.value,selectionMode:"single",placeholder:"请选择因子",size:"small",class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options"])]),l("div",wa,[e[75]||(e[75]=l("span",{class:"text-xs text-gray-600 dark:text-gray-300"},"因子参数",-1)),l("div",Ca,[o(Nt,{parameData:i[1],"onUpdate:parameData":Xe=>i[1]=Xe},null,8,["parameData","onUpdate:parameData"]),o(n,{icon:"pi pi-trash",severity:"danger",text:"",rounded:"",size:"small",onClick:()=>{t.value.other_factor_list&&t.value.other_factor_list.splice(It,1)}},null,8,["onClick"])])])]))),128)),A.value?(a(),y(V,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>[g(_(A.value),1)]),_:1})):p("",!0)])):(a(),c("div",$a," 暂无分域配置，点击上方按钮添加 "))])])):p("",!0)])])]}),_:1},512)]),_:1},8,["visible","header","position"]),o(Ge,{group:"close"})],64)}}}),Da={class:"space-y-4"},Oa={class:"flex items-center justify-between"},Ia={class:"flex flex-wrap justify-between items-center gap-2"},La=["onClick"],Va={key:1},Na={class:"flex flex-wrap justify-between items-center gap-2"},Fa=["onClick"],Ta={key:1},za={class:"flex items-center gap-1"},Ua={class:"pi pi-question-circle cursor-pointer"},Ma={class:"flex items-center gap-1"},ja={class:"pi pi-question-circle cursor-pointer"},Aa={class:"flex items-center gap-1"},Ea={class:"pi pi-question-circle cursor-pointer"},Ha={key:0,class:"flex items-center gap-1 flex-wrap"},qa={key:0,class:"cursor-pointer text-xs text-primary-500 dark:text-primary-300"},Ja={class:"flex items-center gap-1"},Pa={class:"pi pi-question-circle cursor-pointer"},Ba={class:"flex items-center gap-1"},Ra={class:"pi pi-question-circle cursor-pointer"},Wa={class:"flex items-center gap-1"},Ya={class:"pi pi-question-circle cursor-pointer"},Ga={class:"flex items-center gap-1"},Ka={class:"pi pi-question-circle cursor-pointer"},Za={class:"flex items-center gap-1"},Qa={class:"pi pi-question-circle cursor-pointer"},Xa={class:"flex items-center gap-1"},eo={class:"pi pi-question-circle cursor-pointer"},to={key:0,class:"flex flex-wrap gap-1"},lo={key:1},so={class:"w-25 flex flex-col items-center"},ao={class:"flex flex-col gap-4"},oo={key:0},io={key:0,class:"font-semibold text-sm text-gray-500 dark:text-gray-400"},no={key:1,class:"font-semibold text-sm text-gray-500 dark:text-gray-400"},ro={key:0,class:"font-medium text-xs"},uo={key:0,class:"space-x-2"},co={key:1,class:"space-x-2"},fo={key:1,class:"font-medium text-xs"},vo={key:0,class:"font-medium text-xs"},po={key:1,class:"font-medium text-xs"},mo={key:0,class:"font-bold"},_o={key:0,class:"font-bold"},go={key:1,class:"font-bold"},yo={key:0},xo={class:"font-medium text-xs"},bo={key:2,class:"font-medium text-xss"},ho={key:0,class:"font-medium text-xs flex gap-1 flex-wrap"},ko={key:1,class:"text-gray-400 text-xs"},wo={key:1,class:"text-gray-400 text-xs"},Co={class:"space-y-2 text-sm"},$o={class:"flex items-center gap-2"},So={class:"flex items-center gap-2"},Do={class:"flex items-center gap-2"},Oo={class:"space-y-4"},Io={class:"flex gap-4"},Lo={key:0,class:"space-y-2"},Vo={class:"flex gap-3"},No={class:"flex justify-end gap-2"},Fo={class:"font-semibold"},To={class:"flex flex-col gap-4"},zo={class:"flex flex-col gap-2"},Uo={key:0,class:"text-red-500 text-xs"},Mo={class:"flex justify-end gap-2"},jo=at({__name:"strategyConfig.tmpl",props:{nameErrorMessage:{}},emits:["refreshConfigInfo"],setup(Qe,{expose:Z,emit:Ee}){const me=ot(),De=it(),P=d(),be=Ee,ae=d("新增策略"),B=d(Ae),ee=d(Ae),t=d(!1),b=d(""),x=d("因子"),te=d(["因子","前置过滤因子","后置过滤因子"]),R=d([]),M=d({factorList:[],filterList:[],filterListPost:[],crossList:[]}),q=d(!1),le=d(),E=d([]),oe=d([]),W=d(null),H=d(!1),F=d(!0),J=d(""),Q=d([]),Y=d(!1),T=d({策略直播:[],论坛帖子:[],相关船队:[],策略说明:"",使用案例:{}}),se=d(!1),L=d(),ie=d({相关直播:[],相关帖子:[],因子说明:"",因子案例:[],过滤因子案例:[]}),j=d(!1),he=d(),de=d(!1),_e=d(!1),ne=d(),G=d(""),A=d(""),Fe=d([]);At(async()=>{const s=await Xt();s.result===!0?Q.value=s.data:Q.value=[]});const He=s=>{B.value=JSON.parse(JSON.stringify(s)),ee.value=JSON.parse(JSON.stringify(s))},ge=s=>{let e=!1;return e=Q.value.includes(s),e},Te=async(s,e)=>{var n;ae.value=s,s==="新增策略"?(H.value=!0,F.value=!0,J.value=""):P.value&&((n=P.value)==null||n.openDrawer(e,ge(e.strategy)))},ke=async()=>{var s,e,n;if(F.value===!0)if(J.value){Y.value=!0;const v=await lt(encodeURIComponent(J.value),Se.strategy);Y.value=!1,v.result===!0&&v.data&&(s=v.data)!=null&&s.使用案例&&P.value&&(H.value=!1,(e=P.value)==null||e.openDrawer(v.data.使用案例,!0))}else me.add({severity:"error",summary:"你还未选择策略",life:3e3});else H.value=!1,P.value&&((n=P.value)==null||n.openDrawer(null))},qe=async s=>{await re(),t.value=!0;let e=[];s!=null&&s.long_factor_list&&s.long_factor_list.length>0||s!=null&&s.short_factor_list&&s.short_factor_list.length>0?e=[(s==null?void 0:s.long_factor_list)||[],(s==null?void 0:s.short_factor_list)||[]]:e=[s.factor_list];let n=[];s!=null&&s.long_filter_list&&s.long_filter_list.length>0||s!=null&&s.short_filter_list&&s.short_filter_list.length>0?n=[(s==null?void 0:s.long_filter_list)||[],(s==null?void 0:s.short_filter_list)||[]]:n=[s.filter_list];let v=[];s!=null&&s.long_filter_list_post&&s.long_filter_list_post.length>0||s!=null&&s.short_filter_list_post&&s.short_filter_list_post.length>0?v=[(s==null?void 0:s.long_filter_list_post)||[],(s==null?void 0:s.short_filter_list_post)||[]]:v=[s.filter_list_post],M.value={factorList:e,filterList:n,filterListPost:v,crossList:[[]]},x.value="因子",R.value=[...M.value.factorList]},Je=()=>{x.value==="因子"?R.value=[...M.value.factorList]:x.value==="前置过滤因子"?R.value=[...M.value.filterList]:x.value==="后置过滤因子"?R.value=[...M.value.filterListPost]:x.value==="截面因子"&&(R.value=[...M.value.crossList])},N=async()=>{const s={...B.value};s.start_date&&s.start_date instanceof Date&&(s.start_date=st(s.start_date).format("YYYY-MM-DD")),s.end_date&&s.end_date instanceof Date&&(s.end_date=st(s.end_date).format("YYYY-MM-DD")),(await jt(s)).result===!0&&be("refreshConfigInfo")},r=s=>{De.require({group:"remove",message:"确定要删除该策略吗？",header:"删除确认",icon:"pi pi-exclamation-triangle text-yellow-500",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"确定"},accept:()=>{D(s)},reject:()=>{}})},D=s=>{if(B.value.strategy_list.length===1){me.add({severity:"error",summary:"策略最少要保留一个",life:3e3});return}B.value.strategy_list=B.value.strategy_list.filter(e=>e.id!==s.id),N()},re=async()=>{const s=await Mt();s.result===!0&&(W.value=s.data,E.value=[],oe.value=[],s.data!==null&&Object.keys(s.data).length>0&&(Object.keys(s.data).forEach(n=>{const v=s.data;E.value.push({key:n,label:n==="factors"?"时序因子":"截面因子",selectable:!1,children:v[n].map(h=>({key:h.name,label:h.name}))||[]})}),oe.value=JSON.parse(JSON.stringify(E.value))))},ue=Ze(()=>{const s=new Map;return e=>{if(!e)return null;const n=typeof e=="string"?e:JSON.stringify(e);if(s.has(n))return s.get(n);const v=ze(e);return s.set(n,v),v}}),ze=s=>{var h,V;const e=Pe(s);if(!e||!oe.value)return null;const n=z=>(z==null?void 0:z.find(ce=>ce.name===e))||null,v=n(((h=W.value)==null?void 0:h.factors)||[])||n(((V=W.value)==null?void 0:V.sections)||[]);return v?Oe(v):null},Pe=s=>typeof s=="string"?s:typeof s=="object"&&s!==null&&Object.keys(s)[0]||"",Oe=s=>({name:s.name||"",fin_cols:Array.isArray(s.fin_cols)?s.fin_cols:[],extra_data:typeof s.extra_data=="object"&&s.extra_data!==null?s.extra_data:{},ov_cols:Array.isArray(s.ov_cols)?s.ov_cols:[]}),ye=async(s,e,n)=>{L.value&&L.value.toggle(s),Ie(e,n)},Ie=async(s,e)=>{se.value=!0;const n=await lt(encodeURIComponent(s),e);se.value=!1,n.result===!0?T.value=n.data||{策略直播:[],论坛帖子:[],相关船队:[],策略说明:"",使用案例:{}}:T.value={策略直播:[],论坛帖子:[],相关船队:[],策略说明:"",使用案例:{}}},Be=s=>{Ie(s,Se.strategy)},Re=s=>{},Le=(s,e)=>{var h,V;he.value&&he.value.toggle(s),j.value=!0;let n=((h=W.value)==null?void 0:h.factors)||[];for(let z of n)if(z.name===e){ie.value=z.info,j.value=!1;return}let v=((V=W.value)==null?void 0:V.sections)||[];for(let z of v)if(z.name===e){ie.value=z.info,j.value=!1;return}j.value=!1},Ve=s=>{de.value=!0,ne.value=s,A.value=`${ne.value.strategy}寻参`,Ue()},Ue=async()=>{var n,v;let s=[];const e=await el();if(e.result===!0&&(s=((n=e.data)==null?void 0:n.configs)||[],s.length>0&&s.includes("config"))){const h=await tl("config");h.result===!0&&(s=[...s,((v=h.data)==null?void 0:v.search_name)||""])}Fe.value=s},we=()=>(G.value="",A.value.trim()?A.value.trim().length<2?(G.value="遍历配置名称至少需要2个字符",!1):A.value.trim().length>50?(G.value="遍历配置名称不能超过50个字符",!1):Fe.value.includes(A.value.trim())||A.value.trim()==="config"?(G.value="遍历配置名称已存在",!1):/[<>"/\\|?*]/.test(A.value)?(G.value='遍历配置名称不能包含特殊字符 < > " / \\ | ? *',!1):!0:(G.value="遍历配置名称不能为空",!1)),w=async()=>{if(we()===!0){_e.value=!0;let s=JSON.parse(JSON.stringify(ne.value));s==null||delete s.id,s=ll(s);const e=await sl({name:A.value,search_name:A.value,strategy_info:s});_e.value=!1,e.result===!0&&(de.value=!1,A.value="",me.add({severity:"success",summary:"新增成功！",life:3e3}))}};return Z({loadData:He}),(s,e)=>{const n=ut,v=xl,h=Rt,V=qt,z=yl,ce=Et,ve=Jt,Ce=Pt,pe=Bt,xe=El,Ne=rt,O=nt;return a(),c(S,null,[l("div",Da,[e[27]||(e[27]=l("div",{class:"font-semibold flex items-center justify-between gap-4"},[l("span",null,"策略配置")],-1)),o(z,{value:ee.value.strategy_list||[],paginator:"",totalRecords:ee.value.strategy_list.length,rowsPerPageOptions:[5,10,20,50],rows:5,class:"border-1 border-gray-200 dark:border-neutral-700 px-3 py-2 rounded-lg",pt:{table:{class:"text-xs overflow-x-auto"},header:{class:"pt-0 pb-2"}},scrollable:""},{header:u(()=>[l("div",Oa,[e[15]||(e[15]=l("div",null,[l("span",{class:"font-semibold"},"多策略混合")],-1)),o(n,{type:"button",icon:"pi pi-plus",label:"新增策略",outlined:"",size:"small",onClick:e[0]||(e[0]=f=>Te("新增策略",null))})])]),empty:u(()=>e[26]||(e[26]=[l("div",{class:"flex items-center justify-center h-full"},[l("img",{src:Ft,class:"w-40 h-full"})],-1)])),default:u(()=>[m(C)==="coin"?(a(),y(v,{key:0,field:"strategy",header:"策略名称",headerClass:"whitespace-nowrap",class:"min-w-45"},{body:u(({data:f})=>[l("div",Ia,[ge(f.strategy)?k((a(),c("span",{key:0,class:"text-xs cursor-pointer text-primary-500 dark:text-primary-300 hover:text-primary-600 hover:dark:text-primary-200",onClick:$=>ye($,f.strategy,m(Se).strategy)},[g(_(f.strategy),1)],8,La)),[[O,"该策略是策略库中的经典策略,点击策略名可查看教学内容"]]):(a(),c("span",Va,_(f.strategy),1)),o(n,{onClick:$=>Ve(f),label:"遍历",size:"small",variant:"outlined",class:"text-xs px-1.5 py-1 gap-1",iconClass:"text-xs",icon:"pi pi-plus"},null,8,["onClick"])])]),_:1})):(a(),y(v,{key:1,field:"name",header:"策略名称",headerClass:"whitespace-nowrap",class:"min-w-45"},{body:u(({data:f})=>[l("div",Na,[ge(f.name)?k((a(),c("span",{key:0,class:"text-xs cursor-pointer text-primary-500 dark:text-primary-300 hover:text-primary-600 hover:dark:text-primary-200",onClick:$=>ye($,f.name,m(Se).strategy)},[g(_(f.name),1)],8,Fa)),[[O,"该策略是策略库中的经典策略,点击策略名可查看教学内容"]]):(a(),c("span",Ta,_(f.name),1)),o(n,{onClick:$=>Ve(f),label:"遍历",size:"small",variant:"outlined",class:"text-xs px-1.5 py-1 gap-1",iconClass:"text-xs",icon:"pi pi-plus"},null,8,["onClick"])])]),_:1})),o(v,{field:"cap_weight",headerClass:"whitespace-nowrap",class:"min-w-10"},{header:u(()=>[l("div",za,[e[16]||(e[16]=l("span",{class:"flex items-center gap-1 font-bold"}," 资金权重 ",-1)),k(l("i",Ua,null,512),[[O,{value:"资金占比，多策略组合时使用，会做归一化计算。如有两个策略，每个策略的cap_weight都设置为1，那么每个子策略的资金占比为 1/(1+1) = 0.5，也就是每个子策略资金占比50%。",autoHide:!1,escape:!1},void 0,{bottom:!0}]])])]),body:u(({data:f})=>[g(_(f.cap_weight.toFixed(3)),1)]),_:1}),o(v,{field:"hold_period",class:"min-w-26"},{header:u(()=>[l("div",Ma,[e[17]||(e[17]=l("span",{class:"flex items-center gap-1 font-bold"}," 持仓周期 ",-1)),k(l("i",ja,null,512),[[O,{value:m(C)==="coin"?"选币持仓的时间，H代表小时，持仓几个小时，有1H到24H一共24种选择；D代表日，1D持仓一天。":"选股交易的持股周期，D表示持股几天，如3D就是持股3天。W表示持股一周，M表示持股一个月。具体参数参照股票周期预运算表的数据文件。",autoHide:!1,escape:!1},void 0,{bottom:!0}]])])]),_:1}),o(v,{field:"offset_list",headerClass:"whitespace-nowrap",class:"min-w-38"},{header:u(()=>[l("div",Aa,[e[18]||(e[18]=l("span",{class:"flex items-center gap-1 font-bold"}," offset_list ",-1)),k(l("i",Ea,null,512),[[O,{value:m(C)==="coin"?"选择持仓的offset，具体原理请参考：<a href='https://bbs.quantclass.cn/thread/46812' target='_blank' class='text-primary-500 hover:underline'>【小白入门】持仓周期，offset和分钟偏移——入门基础知识系列 - 量化小论坛</a>":"与持股周期配合的具体offset，具体原理请参考：<a href='https://bbs.quantclass.cn/thread/46812' target='_blank' class='text-primary-500 hover:underline'>【小白入门】持仓周期，offset和分钟偏移——入门基础知识系列 - 量化小论坛</a>",autoHide:!1,escape:!1},void 0,{bottom:!0}]])])]),body:u(({data:f})=>[f.offset_list&&f.offset_list.length?(a(),c("div",Ha,[(a(!0),c(S,null,$e(f.offset_list.slice(0,3),($,U)=>(a(),y(h,{key:$,class:"font-medium text-xs",severity:"secondary"},{default:u(()=>[g(_($),1)]),_:2},1024))),128)),f.offset_list.length>3?k((a(),c("span",qa,[g("+"+_(f.offset_list.length-3),1)])),[[O,{value:`所有选择持仓的offset：${f.offset_list.join(", ")}`,autoHide:!1},void 0,{bottom:!0}]]):p("",!0)])):p("",!0)]),_:1}),m(C)==="coin"?(a(),c(S,{key:2},[o(v,{field:"market",headerClass:"whitespace-nowrap",class:"min-w-50"},{header:u(()=>[l("div",Ja,[e[19]||(e[19]=l("span",{class:"flex items-center gap-1 font-bold"}," 选币范围（现货/合约） ",-1)),k(l("i",Pa,null,512),[[O,{value:m(Tt),autoHide:!1,escape:!1,class:"min-w-90"},void 0,{bottom:!0}]])])]),body:u(({data:f})=>[k((a(),y(h,{class:"font-medium text-xs",severity:"secondary"},{default:u(()=>{var $;return[g(_(($=m(zt).find(U=>U.value===f.market))==null?void 0:$.label),1)]}),_:2},1024)),[[O,m(Ut)[f.market]]])]),_:1}),o(v,{field:"long_cap_weight",headerClass:"whitespace-nowrap",class:"min-w-10"},{header:u(()=>[l("div",Ba,[e[20]||(e[20]=l("span",{class:"flex items-center gap-1 font-bold"}," 多头权重 ",-1)),k(l("i",Ra,null,512),[[O,{value:"多头在子策略的仓位占比，如1表示纯多策略",autoHide:!1},void 0,{bottom:!0}]])])]),_:1}),o(v,{field:"short_cap_weight",headerClass:"whitespace-nowrap",class:"min-w-10"},{header:u(()=>[l("div",Wa,[e[21]||(e[21]=l("span",{class:"flex items-center gap-1 font-bold"}," 空头权重 ",-1)),k(l("i",Ya,null,512),[[O,{value:"空头在子策略的仓位占比，如1表示纯空策略",autoHide:!1},void 0,{bottom:!0}]])])]),_:1}),o(v,{field:"long_select_coin_num",header:"多头选币数量",headerClass:"whitespace-nowrap",class:"min-w-30"}),o(v,{field:"short_select_coin_num",header:"空头选币数量",headerClass:"whitespace-nowrap",class:"min-w-30"},{body:u(({data:f})=>[f.short_select_coin_num==="long_nums"?(a(),c(S,{key:0},[g(" 和多头选币数量一致 ")],64)):(a(),c(S,{key:1},[g(_(f.short_select_coin_num),1)],64))]),_:1})],64)):(a(),c(S,{key:3},[o(v,{field:"select_num",headerClass:"whitespace-nowrap",class:"min-w-10"},{header:u(()=>[l("div",Ga,[e[22]||(e[22]=l("span",{class:"flex items-center gap-1 font-bold"}," 选股数量 ",-1)),k(l("i",Ka,null,512),[[O,{value:"选股数量，可以是整数，如10就是选股10只。也可以是小数，如0.1就是选全市场10%的股票，约500+只。",autoHide:!1,escape:!1},void 0,{bottom:!0}]])])]),_:1}),o(v,{field:"rebalance_time",headerClass:"whitespace-nowrap",class:"min-w-30"},{header:u(()=>[l("div",Za,[e[23]||(e[23]=l("span",{class:"flex items-center gap-1 font-bold"}," 换仓时间 ",-1)),k(l("i",Qa,null,512),[[O,{value:"换仓时机，根据持仓周期和offset交易时，在股票开始时间具体什么时刻卖出和买入。<br/>隔日换仓：'close-open'：offset结束日收盘前卖出，offset开始日开盘后买入；<br/>开盘日内换仓：'open'：offset当天实现换仓，开盘后先卖出再买入；<br/>指定时间换仓：按照5分钟为间隔指定交易日内换仓时间，如'0955-0955'是上午9:55先卖出，再买入。",autoHide:!1,escape:!1,class:"min-w-85"},void 0,{bottom:!0}]])])]),body:u(({data:f})=>[o(h,{class:"font-medium text-xs",severity:"secondary"},{default:u(()=>[g(_(f.rebalance_time||"未设置"),1)]),_:2},1024)]),_:1})],64)),m(C)==="stock"?(a(),y(v,{key:4,field:"timing",headerClass:"whitespace-nowrap",class:"min-w-24"},{header:u(()=>[l("div",Xa,[e[24]||(e[24]=l("span",{class:"flex items-center gap-1 font-bold"}," 择时信号 ",-1)),k(l("i",eo,null,512),[[O,{value:"25年旗舰策略定风波盘中择时配置，原理请参考：<a href='https://www.quantclass.cn/online-player/679080b1fddb45271bef62c4' target='_blank' class='text-primary-500 hover:underline'>大A定风波再择时策略</a>,<a href='https://www.quantclass.cn/online-player/68341add32a9c6fe538027f3' target='_blank' class='text-primary-500 hover:underline'>大A「定风波2」再择时策略</a>",autoHide:!1,escape:!1},void 0,{bottom:!0}]])])]),body:u(({data:f})=>[f.timing?(a(),c("div",to,[k((a(),y(h,{class:"font-medium text-xs cursor-pointer",onClick:$=>Re(f)},{default:u(()=>[g(_(f.timing.name||"--"),1)]),_:2},1032,["onClick"])),[[O,"点击查看全部信息"]])])):(a(),c("div",lo,"--"))]),_:1})):p("",!0),o(v,{header:"操作",headerClass:"whitespace-nowrap",class:"min-w-40",frozen:!0,alignFrozen:"right"},{body:u(({data:f})=>[l("div",so,[o(n,{class:"text-xs",size:"small",severity:"secondary",variant:"outlined",onClick:$=>qe(f)},{default:u(()=>e[25]||(e[25]=[g(" 查看因子信息 ")])),_:2,__:[25]},1032,["onClick"]),l("div",null,[k(o(n,{size:"small",text:"",icon:"pi pi-pen-to-square",onClick:$=>Te("编辑策略",f)},null,8,["onClick"]),[[O,"编辑"]]),k(o(n,{size:"small",text:"",icon:"pi pi-trash",severity:"secondary",onClick:$=>r(f)},null,8,["onClick"]),[[O,"删除"]])])]),o(V,{group:"remove"})]),_:1})]),_:1},8,["value","totalRecords"])]),o(ve,{visible:t.value,"onUpdate:visible":e[3]||(e[3]=f=>t.value=f),closable:!1,modal:"",class:"max-w-[90vw]"},{footer:u(()=>[o(n,{label:"关闭",size:"small",severity:"secondary",variant:"outlined",onClick:e[2]||(e[2]=f=>t.value=!1)})]),default:u(()=>[l("div",ao,[o(ce,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=f=>x.value=f),options:te.value,size:"small",onValueChange:Je},null,8,["modelValue","options"]),x.value!=="截面因子"?(a(!0),c(S,{key:0},$e(R.value,(f,$)=>(a(),c(S,null,[R.value.length===2?(a(),c("div",oo,[$===0?(a(),c("span",io,"多头")):p("",!0),$===1?(a(),c("span",no,"空头")):p("",!0)])):p("",!0),o(z,{value:f,paginator:"",rows:5,class:"text-sm"},{empty:u(()=>e[33]||(e[33]=[l("div",{class:"flex items-center justify-center h-full"},[l("img",{src:Ft,class:"w-40 h-auto"})],-1)])),default:u(()=>[o(v,{header:x.value==="因子"?"因子":x.value==="前置过滤因子"?"前置过滤因子":"后置过滤因子",style:{width:"100px"}},{body:u(({data:U})=>[k((a(),y(h,{class:"font-medium text-xs cursor-pointer",onClick:Me=>Le(Me,U[0])},{default:u(()=>[g(_(U[0]),1)]),_:2},1032,["onClick"])),[[O,"点击可查看该因子相关教程"]])]),_:1},8,["header"]),o(v,{header:x.value==="因子"?"排序方式":"因子参数",style:{width:"100px"}},{body:u(({data:U})=>[x.value==="因子"?(a(),c("div",ro,[U[1]?(a(),c("div",uo,e[28]||(e[28]=[l("span",null,"升序",-1),l("i",{class:"pi pi-arrow-up text-xs"},null,-1)]))):(a(),c("div",co,e[29]||(e[29]=[l("span",null,"降序",-1),l("i",{class:"pi pi-arrow-down text-xs"},null,-1)])))])):(a(),c("div",fo,_(U[1]||"无参数"),1))]),_:1},8,["header"]),o(v,{header:x.value==="因子"?"因子参数":"因子使用条件",style:{width:"140px"}},{body:u(({data:U})=>[x.value==="因子"?(a(),c("div",vo,_(U[2]||"无参数"),1)):(a(),c("div",po,_(U[2]),1))]),_:1},8,["header"]),o(v,{class:"min-w-35"},{header:u(()=>[m(C)==="coin"?(a(),c("span",mo,_(x.value==="因子"?"因子权重":"排序方式"),1)):(a(),c(S,{key:1},[ge(b.value)?(a(),c("span",_o,_(x.value==="因子"?"因子组合参数":"排序方式"),1)):(a(),c("span",go,_(x.value==="因子"?"因子权重":"排序方式"),1))],64))]),body:u(({data:U})=>[x.value==="因子"?(a(),c("div",yo,[l("div",xo,_(U[3]),1)])):(a(),c("div",bo,e[32]||(e[32]=[l("div",{class:"space-x-2"},[l("span",null,"升序"),l("i",{class:"pi pi-arrow-up text-xs"})],-1)])))]),_:1}),m(C)==="stock"?(a(),c(S,{key:0},[m(C)==="stock"?(a(),y(v,{key:0,header:"数据依赖关系",class:"min-w-30"},{body:u(({data:U})=>{var Me,Ye,Ge;return[U[0]?(a(),c("div",ho,[ue.value(U[0])?(a(),c(S,{key:0},[o(et,{value:(Me=ue.value(U[0]))==null?void 0:Me.fin_cols,label:"财务数据",type:"array"},null,8,["value"]),o(et,{value:(Ye=ue.value(U[0]))==null?void 0:Ye.extra_data,label:"额外数据",type:"object"},null,8,["value"]),o(et,{value:(Ge=ue.value(U[0]))==null?void 0:Ge.ov_cols,label:"全息数据",type:"array"},null,8,["value"])],64)):(a(),c("span",ko,"无依赖数据"))])):(a(),c("span",wo,"未配置因子"))]}),_:1})):p("",!0)],64)):p("",!0)]),_:2},1032,["value"])],64))),256)):(a(!0),c(S,{key:1},$e(R.value,(f,$)=>(a(),y(Ht,{factorList:f,factorNameOpetions:oe.value,allFactorInfo:W.value,isEdit:!1},null,8,["factorList","factorNameOpetions","allFactorInfo"]))),256))])]),_:1},8,["visible"]),o(ve,{header:"择时信号",closable:!0,visible:q.value,"onUpdate:visible":e[4]||(e[4]=f=>q.value=f),draggable:!1,modal:!0,class:"max-w-[90vw]",pt:{footer:"justify-between items-center"}},{default:u(()=>[l("div",Co,[l("div",$o,[e[34]||(e[34]=l("span",{class:"font-bold text-gray-700 dark:text-gray-300"},"择时策略名称:",-1)),o(h,{class:"font-medium"},{default:u(()=>[g(_(le.value.name||"未设置"),1)]),_:1})]),l("div",So,[e[35]||(e[35]=l("span",{class:"font-bold text-gray-700 dark:text-gray-300"},"择时阈值(limit):",-1)),o(h,{severity:"secondary",class:"font-medium"},{default:u(()=>[g(_(le.value.limit||"未设置"),1)]),_:1})]),l("div",Do,[e[36]||(e[36]=l("span",{class:"font-bold text-gray-700 dark:text-gray-300"},"择时参数:",-1)),o(h,{severity:"secondary",class:"font-medium"},{default:u(()=>[g(_(le.value.params||"无参数"),1)]),_:1})]),o(fe,{propkey:"3",factorList:le.value.factor_list||[],title:"择时",factorSelect:"因子",factorNameOpetions:E.value,allFactorInfo:W.value,disabled:!0,isDemoStrategy:ge(b.value)},null,8,["factorList","factorNameOpetions","allFactorInfo","isDemoStrategy"]),o(We,{isLoading:se.value,teachInfo:T.value},null,8,["isLoading","teachInfo"])])]),_:1},8,["visible"]),o(Sa,{ref_key:"refAddOrEditStrategyDrawer",ref:P,nameErrorMessage:s.nameErrorMessage,drawerTitle:ae.value,allConfigInfo:ee.value,onRefreshConfigInfo:e[5]||(e[5]=f=>be("refreshConfigInfo"))},null,8,["nameErrorMessage","drawerTitle","allConfigInfo"]),o(ve,{visible:H.value,"onUpdate:visible":e[12]||(e[12]=f=>H.value=f),header:"新增策略",draggable:!1,closable:!1,modal:"",class:"w-[90vw] sm:w-[600px] max-w-full"},{footer:u(()=>[l("div",No,[o(n,{label:"取消",severity:"secondary",outlined:"",size:"small",onClick:e[11]||(e[11]=f=>H.value=!1)}),o(n,{label:"确定",size:"small",onClick:ke,loading:Y.value},null,8,["loading"])])]),default:u(()=>[l("div",Oo,[l("div",Io,[l("div",{onClick:e[7]||(e[7]=f=>F.value=!0),class:"flex-1 flex items-center px-4 py-5 border border-gray-200 dark:border-gray-700 rounded-md cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"},[o(Ce,{modelValue:F.value,"onUpdate:modelValue":e[6]||(e[6]=f=>F.value=f),inputId:"strategy-library",name:"strategy-mode",value:!0,class:"mr-3"},null,8,["modelValue"]),e[37]||(e[37]=l("div",{class:"text-center flex-1 space-y-1"},[l("div",{class:"font-medium text-gray-800 dark:text-gray-200"}," 从策略库导入 "),l("div",{class:"text-xs text-gray-500 dark:text-gray-400"}," 使用预设经典策略（推荐新手） ")],-1))]),l("div",{onClick:e[9]||(e[9]=f=>F.value=!1),class:"flex-1 flex items-center px-4 py-5 border border-gray-200 dark:border-gray-700 rounded-md cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"},[o(Ce,{modelValue:F.value,"onUpdate:modelValue":e[8]||(e[8]=f=>F.value=f),inputId:"custom-strategy",name:"strategy-mode",value:!1,class:"mr-3"},null,8,["modelValue"]),e[38]||(e[38]=l("div",{class:"text-center flex-1 space-y-1"},[l("div",{class:"font-medium text-gray-800 dark:text-gray-200"}," 自定义策略 "),l("div",{class:"text-xs text-gray-500 dark:text-gray-400"}," 手动配置参数与规则（进阶） ")],-1))])]),F.value===!0?(a(),c("div",Lo,[e[39]||(e[39]=l("div",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 选择策略 ",-1)),l("div",Vo,[o(pe,{modelValue:J.value,"onUpdate:modelValue":e[10]||(e[10]=f=>J.value=f),options:Q.value,placeholder:"请从策略库中选择指定策略",filter:"",class:"flex-1",onValueChange:Be},null,8,["modelValue","options"])])])):p("",!0),F.value&&J.value?(a(),y(We,{key:1,isLoading:se.value,teachInfo:T.value},null,8,["isLoading","teachInfo"])):p("",!0)])]),_:1},8,["visible"]),o(xe,{ref_key:"refOp",ref:L,class:"bg-gray-50 dark:bg-neutral-800 pr-1 max-w-[50vw]"},{default:u(()=>[o(We,{isLoading:se.value,teachInfo:T.value},null,8,["isLoading","teachInfo"])]),_:1},512),o(xe,{ref_key:"refFactorOp",ref:he,class:"bg-gray-50 dark:bg-neutral-800 pr-1 max-w-[50vw]"},{default:u(()=>[o(bl,{isLoading:j.value,teachInfo:ie.value},null,8,["isLoading","teachInfo"])]),_:1},512),o(ve,{visible:de.value,"onUpdate:visible":e[14]||(e[14]=f=>de.value=f),modal:"",closable:!0,draggable:!1,class:"max-w-[90vw] min-w-[40vw]"},{header:u(()=>[l("span",Fo,_(m(C)==="coin"?ne.value.strategy:ne.value.name)+"寻参",1)]),footer:u(()=>[l("div",Mo,[o(n,{label:"确定",size:"small",loading:_e.value,onClick:w},null,8,["loading"])])]),default:u(()=>[l("div",To,[l("div",zo,[e[40]||(e[40]=l("label",{for:"backupName",class:"gap-1 flex items-center"},[l("span",{class:"text-red-500"},"*"),l("span",{class:"text-sm font-bold"},"新遍历配置名称"),l("div",{class:"text-xs text-gray-500 dark:text-gray-400"}," (例如：xx策略寻参) ")],-1)),o(Ne,{id:"backupName",modelValue:A.value,"onUpdate:modelValue":e[13]||(e[13]=f=>A.value=f),placeholder:"请输入新遍历配置名称",invalid:!!G.value,size:"small",fluid:""},null,8,["modelValue","invalid"]),G.value?(a(),c("span",Uo,_(G.value),1)):p("",!0)])])]),_:1},8,["visible"])],64)}}}),Ao={class:"flex items-center justify-between py-3 pl-4 pr-1"},Eo={class:"font-semibold"},Ho={class:"space-x-1"},qo={class:"flex-1 w-full min-w-0 space-y-1 font-semibold"},Jo={class:"text-xs text-gray-500 dark:text-gray-300 truncate"},Po={class:"flex-1 overflow-y-auto px-4"},Bo={class:"space-y-1"},Ro=["onMouseenter","onClick"],Wo={class:"flex-1 truncate"},Yo={class:"flex-1 min-w-0 h-full flex flex-col relative"},Go={class:"px-4 py-3 flex items-center justify-between sticky left-0 top-0"},Ko={class:"space-x-2"},Zo={key:0,class:"font-semibold"},Qo={class:"flex gap-2"},Xo={class:"flex gap-2"},ei={class:"px-5 py-3 space-y-6 overflow-y-auto overflow-x-hidden"},ti={class:"flex flex-col gap-2"},li={class:"flex items-center"},si={class:"flex flex-col gap-2 pl-2"},ai={class:"space-x-3 w-full flex justify-end"},oi={class:"flex items-center justify-between w-full"},ii={class:"text-xs text-gray-500 dark:text-gray-300 flex items-center gap-2"},ni={class:"space-x-3"},ri={key:0,class:"fixed inset-0 bg-black/20 z-50 flex items-center justify-center"},ui={class:"bg-white dark:bg-neutral-800 p-8 rounded-lg shadow-2xl flex flex-col items-center"},ci={class:"flex flex-col gap-4"},fi={class:"space-y-4"},di={class:"flex flex-col gap-3 pl-2"},vi={class:"flex items-center gap-2"},pi={for:"export_strategy",class:"cursor-pointer"},mi={class:"font-semibold"},_i={class:"flex items-center gap-2"},gi={for:"export_live",class:"cursor-pointer"},yi={class:"font-semibold"},xi={class:"space-x-3 w-full flex justify-end"},Di=at({__name:"strategy-manage.page",setup(Qe){const Z=ot(),Ee=it(),me=d(null),De=d(null),P=d(null),be=d(null),ae=d(null),B=d(null),ee=d(null),t=d([]),b=d(""),x=d(Ae),te=d(""),R=d(),M=d(null),q=d(!1),le=d(!1),E=d(""),oe=d(!1),W=d(!1),H=d(null),F=d(!1),J=d(!1),Q=d(!1),Y=d("strategy");At(()=>{T()});const T=async()=>{var r;const N=await al();N.result===!0&&(t.value=((r=N.data)==null?void 0:r.configs.filter(D=>D!=="config"))||[]),se("config")},se=N=>{b.value=N,L(N)},L=async N=>{if(b.value==="无名称配置")x.value={...JSON.parse(JSON.stringify(Ae)),name:""};else{const r=await ol(N);r.result===!0?(x.value={...JSON.parse(JSON.stringify(Ae)),...JSON.parse(JSON.stringify(r.data)),name:b.value},N==="config"&&(te.value=x.value.backtest_name)):x.value={...JSON.parse(JSON.stringify(Ae)),name:b.value}}he(),ie()},ie=()=>{var N,r,D,re,ue;me.value&&((N=me.value)==null||N.loadData(x.value)),De.value&&((r=De.value)==null||r.loadData(x.value)),P.value&&((D=P.value)==null||D.loadData(x.value)),be.value&&((re=be.value)==null||re.loadData(x.value)),ae.value&&((ue=ae.value)==null||ue.loadData(x.value))},j=()=>{x.value.backtest_name=x.value.name||"",ie(),he()},he=()=>{if(E.value="",b.value==="无名称配置"){if(x.value.name===""||x.value.name==="无名称配置"){E.value="配置名不能为空,且不能为“无名称配置”";return}(t.value.includes(x.value.name||"")||x.value.name==="config"||x.value.name===te.value)&&(E.value="配置名不能与已有配置名称重复")}},de=()=>{if(t.value.includes("无名称配置")){Z.add({severity:"error",summary:"请先将'无名称配置'保存或删除",life:3e3});return}t.value.push("无名称配置"),se("无名称配置")},_e=Ze(()=>[{label:"复制配置",icon:"pi pi-copy",command:()=>{B.value&&B.value.openDialog(b.value,x.value.backtest_name)},class:b.value==="无名称配置"?"hidden":""},{label:"删除",icon:"pi pi-trash",command:()=>{ne()},class:b.value==="config"?"hidden":""}]),ne=async()=>{if(b.value==="config"){Z.add({severity:"warn",summary:"当前策略正在使用中不可删除！",life:3e3});return}Ee.require({group:b.value,header:"删除",message:`你确定要删除「${b.value}」吗?`,icon:"pi pi-info-circle",rejectProps:{label:"取消",severity:"secondary",outlined:!0},acceptProps:{label:"删除",severity:"danger"},accept:async()=>{if(b.value==="无名称配置"){T(),Z.add({severity:"success",summary:"删除成功",life:3e3});return}(await il(b.value)).result===!0&&(Z.add({severity:"success",summary:"删除成功",life:3e3}),T())},reject:()=>{}})},G=N=>{rl(()=>{R.value.toggle(N)})},A=()=>{ee.value&&ee.value.openDialog()},Fe=()=>{Z.add({severity:"warn",summary:"导出功能还在开发中，敬请期待！",life:4e3})},He=async()=>{var N;try{if(!Y.value)return;Q.value=!0;const r=await ul(b.value);if(Q.value=!1,r.result===!0&&((N=r.data)!=null&&N.filename)){const D=document.createElement("a"),re="";D.href=`${re}/qronos/config/download?filename=${encodeURIComponent(r.data.filename)}`,D.download=r.data.filename,document.body.appendChild(D),D.click(),document.body.removeChild(D)}else Z.add({severity:"error",summary:"获取文件名失败",life:3e3})}catch{Z.add({severity:"error",summary:"导出失败",life:3e3})}finally{J.value=!1}},ge=async()=>{if(le.value=!0,(await cl("config",fl([...t.value],te.value))).result===!0){Z.add({severity:"success",summary:"复制成功",life:3e3});const r=await dl(encodeURIComponent(b.value));le.value=!1,r.result===!0&&(q.value=!1,Z.add({severity:"success",summary:`配置 "${b.value}" 已成功启用`,life:3e3}),T())}else le.value=!1},Te=()=>{F.value=!1,oe.value=!0,ke(),H.value=setTimeout(()=>{F.value=!0},5e3)},ke=()=>{H.value&&(clearTimeout(H.value),H.value=null)},qe=()=>{ke(),F.value=!0},Je=async()=>{oe.value=!1,W.value=!0;try{(await vl()).result===!0&&Z.add({severity:"success",summary:"回测完成",life:3e3})}finally{W.value=!1}};return nl(()=>{ke()}),(N,r)=>{const D=ut,re=Yt,ue=Al,ze=jl,Pe=rt,Oe=Wt,ye=Rt,Ie=kl,Be=Ml,Re=hl,Le=Jt,Ve=Il,Ue=Pt,we=nt;return a(),c(S,null,[o(Be,{class:"w-full h-full overflow-hidden flex"},{default:u(()=>[o(ze,{size:18,class:"min-w-[232px]"},{default:u(()=>[o(ue,{class:"max-h-full border-0 rounded-none shadow-none",pt:{body:{class:"flex-1 p-0 pb-2 min-h-0"},content:{class:"h-full min-h-0 flex flex-col"}}},{header:u(()=>[l("div",Ao,[l("span",Eo,_(m(C)==="coin"?"选币":"选股")+"策略库",1),l("div",Ho,[k(o(D,{icon:"pi pi-plus",variant:"outlined",size:"small",severity:"secondary",onClick:de},null,512),[[we,"新增策略",void 0,{left:!0}]]),k(o(D,{icon:"pi pi-file-import",severity:"secondary",variant:"outlined",size:"small",onClick:A},null,512),[[we,"导入策略"]])])])]),content:u(()=>[o(re,{class:"m-0"}),l("div",{onMouseenter:r[1]||(r[1]=w=>M.value="config"),onMouseleave:r[2]||(r[2]=w=>M.value=null),onClick:r[3]||(r[3]=w=>se("config")),class:tt(["mb-1 pl-7 pr-1 h-14 flex justify-between items-center gap-2 cursor-pointer py-2 bg-gray-50 hover:bg-primary-50 text-gray-700 hover:text-primary-600 dark:bg-neutral-900 dark:hover:bg-primary-900 dark:text-gray-300 dark:hover:text-primary-100",b.value==="config"?"text-primary-600 bg-primary-50 dark:text-primary-100 dark:bg-primary-900":""])},[l("div",qo,[r[21]||(r[21]=l("div",null,"当前策略",-1)),k((a(),c("div",Jo,[g(_(te.value),1)])),[[we,te.value]])]),M.value==="config"||b.value==="config"?(a(),y(D,{key:0,icon:"pi pi-ellipsis-v",severity:"secondary",text:"","aria-haspopup":"true","aria-controls":"overlay_menu",onClick:r[0]||(r[0]=w=>G(w)),size:"small",class:"w-7 h-7 bg-transparent hover:bg-gray-200 dark:hover:bg-neutral-900"})):p("",!0)],34),l("div",Po,[l("ul",Bo,[(a(!0),c(S,null,$e(t.value,w=>(a(),c("li",{onMouseenter:s=>M.value=w,onMouseleave:r[5]||(r[5]=s=>M.value=null),onClick:s=>se(w),key:w,class:tt(["h-11 flex justify-between items-center gap-2 font-medium text-sm cursor-pointer pl-3 pr-1 py-2 hover:bg-primary-50 text-gray-700 hover:text-primary-600 dark:bg-neutral-900 dark:hover:bg-primary-900 dark:text-gray-300 dark:hover:text-primary-100 rounded-md",b.value===w?"text-primary-600 bg-primary-50 dark:text-primary-100 dark:bg-primary-900":""])},[k((a(),c("span",Wo,[g(_(w),1)])),[[we,w]]),M.value===w||b.value===w?(a(),y(D,{key:0,icon:"pi pi-ellipsis-v",severity:"secondary","aria-haspopup":"true","aria-controls":"overlay_menu",onClick:r[4]||(r[4]=s=>G(s)),size:"small",class:"w-7 h-7 bg-transparent hover:bg-gray-200 dark:hover:bg-neutral-900"})):p("",!0)],42,Ro))),128))])])]),_:1})]),_:1}),o(ze,{size:82},{default:u(()=>[l("div",Yo,[l("div",Go,[l("div",Ko,[b.value!=="无名称配置"?(a(),c("span",Zo,_(x.value.backtest_name),1)):(a(),c(S,{key:1},[l("div",Qo,[r[22]||(r[22]=l("label",{class:"flex items-center gap-1"},[l("span",{class:"text-red-500"},"*"),l("span",null," 配置名: ")],-1)),o(Pe,{modelValue:x.value.name,"onUpdate:modelValue":r[6]||(r[6]=w=>x.value.name=w),placeholder:"填写配置名,不能与已有配置名称重复",size:"small",class:"w-80",onBlur:j},null,8,["modelValue"])]),E.value?(a(),y(Oe,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:u(()=>[g(_(E.value),1)]),_:1})):p("",!0)],64))]),l("div",Xo,[b.value!=="无名称配置"?(a(),y(D,{key:0,severity:"secondary",size:"small",variant:"outlined",icon:"pi pi-file-export",label:"导出",onClick:Fe})):p("",!0),b.value==="config"?(a(),y(ye,{key:1,size:"small",severity:"success",class:"flex items-center gap-1 font-medium"},{default:u(()=>r[23]||(r[23]=[g(" 已启用")])),_:1,__:[23]})):b.value!=="无名称配置"?(a(),y(D,{key:2,size:"small",onClick:r[7]||(r[7]=w=>q.value=!0)},{default:u(()=>r[24]||(r[24]=[g("启用")])),_:1,__:[24]})):p("",!0),b.value==="config"?(a(),y(D,{key:3,size:"small",class:"shadow-lg",onClick:Te},{default:u(()=>r[25]||(r[25]=[g("一键回测")])),_:1,__:[25]})):p("",!0),o(Ie,{group:"backTest",pt:{root:{class:"max-w-[90vw] sm:max-w-[600px]"}}})])]),o(re,{class:"m-0"}),l("div",ei,[b.value==="无名称配置"?(a(),y(Oe,{key:0,severity:"warn",closable:!1,class:"inline-flex"},{default:u(()=>r[26]||(r[26]=[l("div",{class:"space-y-2"},[l("div",{class:"flex items-center font-semibold gap-2"},[l("i",{class:"pi pi-exclamation-circle"}),g("重要提示 ")]),l("ul",{class:"list-disc space-y-1 text-sm pl-5",role:"list"},[l("li",null," 请确保在编辑以下内容前已正确填写配置名，否则将保存失败！ "),l("li",null,"多策略混合，至少要配置一个策略")])],-1)])),_:1,__:[26]})):p("",!0),o($l,{nameErrorMessage:E.value,ref_key:"refDataConfigTmpl",ref:me,onRefreshConfigInfo:r[8]||(r[8]=w=>b.value==="无名称配置"?T():L(b.value))},null,8,["nameErrorMessage"]),o(jo,{ref_key:"refStrategyConfigTmpl",ref:De,nameErrorMessage:E.value,onRefreshConfigInfo:r[9]||(r[9]=w=>b.value==="无名称配置"?T():L(b.value))},null,8,["nameErrorMessage"]),o(Sl,{ref_key:"refStrategyOtherConfigTmpl",ref:P,nameErrorMessage:E.value,onRefreshConfigInfo:r[10]||(r[10]=w=>b.value==="无名称配置"?T():L(b.value))},null,8,["nameErrorMessage"]),o(Dl,{ref_key:"refBackTestSimulationConfigTmpl",ref:be,nameErrorMessage:E.value,onRefreshConfigInfo:r[11]||(r[11]=w=>b.value==="无名称配置"?T():L(b.value))},null,8,["nameErrorMessage"]),o(Ol,{ref_key:"refOtherConfifTmpl",ref:ae,nameErrorMessage:E.value,onRefreshConfigInfo:r[12]||(r[12]=w=>b.value==="无名称配置"?T():L(b.value))},null,8,["nameErrorMessage"])])])]),_:1})]),_:1}),o(Re,{ref_key:"refMenu",ref:R,model:_e.value,popup:!0,class:"min-w-35"},null,8,["model"]),o(Ie,{group:b.value},null,8,["group"]),o(wl,{configNameList:[...t.value,te.value],title:"策略",ref_key:"refCopyConfigDialogTmpl",ref:B,onRefreshConfigInfo:T},null,8,["configNameList"]),o(Cl,{title:"策略包",maxFileSize:5*1024*1024,fileType:".zip",ref_key:"refUploadConfigDialogTmpl",ref:ee,onRefreshConfigInfo:T},null,512),o(Le,{header:"启用确认",visible:q.value,closable:!1,draggable:!1,modal:!0,onHide:r[14]||(r[14]=w=>q.value=!1),class:"max-w-[90vw]",pt:{footer:"justify-between items-center"}},{footer:u(()=>[l("div",ai,[o(D,{label:"取消启用",severity:"secondary",onClick:r[13]||(r[13]=w=>q.value=!1)}),o(D,{label:"确定启用",class:"p-button-primary",loading:le.value,onClick:ge},null,8,["loading"])])]),default:u(()=>[l("div",ti,[l("div",li,[r[27]||(r[27]=l("i",{class:"pi pi-question-circle mr-2 text-xl"},null,-1)),g("确定要启用「"+_(x.value.backtest_name)+"」这个配置吗？ ",1)]),l("div",si,[r[29]||(r[29]=l("div",{class:"text-sm text-gray-500 dark:text-gray-300"}," 系统会自动为你备份当前已启用的配置文件，以便你随时可以恢复。 ",-1)),o(Oe,{severity:"warn",icon:"pi pi-exclamation-triangle",variant:"simple",class:"mb-0",pt:{text:"text-sm"}},{default:u(()=>r[28]||(r[28]=[g(" 启用新策略后，系统将自动清理之前的工具配置信息 ")])),_:1,__:[28]})])])]),_:1},8,["visible"]),o(Le,{header:"回测提示",visible:oe.value,closable:!1,draggable:!1,modal:!0,onHide:r[16]||(r[16]=w=>oe.value=!1),class:"w-120",pt:{footer:"justify-between items-center"}},{footer:u(()=>[l("div",oi,[l("div",ii,[F.value?p("",!0):(a(),c(S,{key:0},[r[30]||(r[30]=g(" 请认真阅读5s后才能点击确定按钮 ")),o(D,{label:"跳过等待",link:"",class:"p-0 underline",onClick:qe})],64))]),l("div",ni,[o(D,{label:"取消",severity:"secondary",onClick:r[15]||(r[15]=w=>oe.value=!1)}),o(D,{label:"确定",class:"p-button-primary",disabled:!F.value,onClick:Je},null,8,["disabled"])])])]),default:u(()=>[r[31]||(r[31]=l("ul",{class:"list-disc pl-6 leading-relaxed space-y-1"},[l("li",null,[g(" 建议使用 "),l("span",{class:"text-primary-500 font-semibold"}," PyCharm "),g("启动回测（体验更优） ")]),l("li",null," 若使用网页版「一键回测」功能，过程中会占用一定时间，屏幕将暂时锁定 "),l("li",null,"回测进行时，请不要刷新页面或执行其他操作，以免影响结果")],-1))]),_:1,__:[31]},8,["visible"]),W.value?(a(),c("div",ri,[l("div",ui,[o(Ve,{class:"mb-4"}),r[32]||(r[32]=l("p",{class:"text-lg font-medium"},"回测进行中，请耐心等待...",-1)),r[33]||(r[33]=l("p",{class:"text-gray-500 dark:text-neutral-400 text-sm mt-2 flex items-center gap-2"},[l("i",{class:"pi pi-exclamation-triangle text-yellow-600"}),g("回测期间请勿刷新页面或关闭浏览器 ")],-1))])])):p("",!0),o(Le,{header:"导出",visible:J.value,closable:!1,draggable:!1,modal:!0,onHide:r[20]||(r[20]=w=>J.value=!1),class:"max-w-[90vw]",pt:{footer:"justify-between items-center"}},{footer:u(()=>[l("div",xi,[o(D,{label:"取消",severity:"secondary",onClick:r[19]||(r[19]=w=>J.value=!1)}),o(D,{label:"确定",class:"p-button-primary",disabled:!Y.value,loading:Q.value,onClick:He},null,8,["disabled","loading"])])]),default:u(()=>[l("div",ci,[l("div",fi,[r[38]||(r[38]=l("div",{class:"font-bold"},"请选择导出方式：",-1)),l("div",di,[l("div",vi,[o(Ue,{modelValue:Y.value,"onUpdate:modelValue":r[17]||(r[17]=w=>Y.value=w),inputId:"export_strategy",name:"export_type",value:"strategy"},null,8,["modelValue"]),l("label",pi,[r[34]||(r[34]=g(" 备份")),l("span",mi,"「"+_(x.value.backtest_name)+"」",1),r[35]||(r[35]=g("策略存于本地 "))])]),l("div",_i,[o(Ue,{modelValue:Y.value,"onUpdate:modelValue":r[18]||(r[18]=w=>Y.value=w),inputId:"export_live",name:"export_type",value:"actualTrading"},null,8,["modelValue"]),l("label",gi,[r[36]||(r[36]=g(" 导出")),l("span",yi,"「"+_(x.value.backtest_name)+"」",1),r[37]||(r[37]=g("策略给实盘客户端使用 "))])])])])])]),_:1},8,["visible"])],64)}}});export{Di as default};
